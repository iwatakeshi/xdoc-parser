"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _ = require("lodash");
const Parser = require("./XDocSyntaxParser");
require("./XDocSyntaxParserVisitor");
const XDocASTNode_1 = require("./XDocASTNode");
/**
 * XDocAST is a class that converts a Antlr parse tree
 * into a Javascript tree object.
 *
 * # API
 *
 * ```
 * @class XDocAST
 * ```
 */
class XDocASTVisitor {
    constructor(documentation, options) {
        this.options = {
            showNodeText: false
        };
        /**
         * Converts the Antlr parse tree into a JavaScript tree object.
         *
         * # API
         *
         * ```
         * @method visit
         * @param context: Parser.DocumentationConext
         * @return: {
         *  name?: string,
         *  id?: {},
         *  value?: {},
         *  type?: {},
         *  description?: {}
         * }[]
         * ```
         */
        this.visit = () => {
            return this.visitDocumentation(this.documentation);
        };
        /* Documentation visitor */
        this.visitDocumentation = (context) => {
            if (context.body()) {
                return XDocASTNode_1.createDocumentationNode(this.visitBody(context.body()), this.options.showNodeText ? context.text : undefined);
            }
        };
        this.visitBody = (context) => {
            if (context.annotations()) {
                return XDocASTNode_1.createBodyNode(this.visitAnnotations(context.annotations()), this.options.showNodeText ? context.text : undefined);
            }
        };
        this.visitAnnotations = (context) => {
            if (context.tag()) {
                return (context.tag() || []).map(this.visitTag);
            }
        };
        this.visitTag = (context) => {
            let name, identifier, type, expression, description;
            if (context.tagName()) {
                name = this.visitTagName(context.tagName());
            }
            if (context.tagIdentifier()) {
                identifier = this.visitTagIdentifier(context.tagIdentifier());
            }
            if (context.type()) {
                type = this.visitType(context.type());
            }
            if (context.expression()) {
                expression = this.visitExpression(context.expression());
            }
            if (context.description()) {
                description = this.visitDescription(context.description());
            }
            return XDocASTNode_1.createTagNode(name, identifier, type, expression, description, this.options.showNodeText ? context.text : undefined);
        };
        this.visitTagName = (context) => {
            if (context.identifier()) {
                return XDocASTNode_1.createTagNameNode(this.visitIdentifier(context.identifier()), this.options.showNodeText ? context.text : undefined);
            }
        };
        this.visitTagIdentifier = (context) => {
            let identifier, property;
            if (context.identifier()) {
                identifier = this.visitIdentifier(context.identifier());
            }
            if (context.optionalTagIdentifier()) {
                identifier = this.visitOptionalTagIdentifer(context.optionalTagIdentifier());
            }
            if (context.propertyTagIdentifier()) {
                property = this.visitPropertyTagIdentifier(context.propertyTagIdentifier());
            }
            return XDocASTNode_1.createTagIdentifierNode(identifier, property, this.options.showNodeText ? context.text : undefined);
        };
        this.visitPropertyTagIdentifier = (context) => {
            // Assume 'context' is defined.
            let identifier = context.identifier() ?
                this.visitIdentifier(context.identifier()) :
                this.visitOptionalTagIdentifer(context.optionalTagIdentifier());
            // A property must exist since by grammar:
            // (optionalTagIdentifier | identifier) ('.' optionalTagOrIdentifier)+
            let property = context.optionalTagOrIdentifier()
                .map(this.visitOptionalTagOrIdentifier);
            // Add the identifier to the beginning of the array
            property.unshift(identifier);
            return XDocASTNode_1.createPropertyTagIdentifierNode(property, context.text);
        };
        this.visitOptionalTagIdentifer = (context) => {
            if (context.optionalIdentifier()) {
                return XDocASTNode_1.createOptionalTagIdentifierNode(this.visitOptionalIdentifier(context.optionalIdentifier()));
            }
        };
        this.visitOptionalTagOrIdentifier = (context) => {
            if (context.identifier()) {
                return this.visitIdentifier(context.identifier());
            }
            if (context.optionalTagIdentifier()) {
                return this.visitOptionalTagIdentifer(context.optionalTagIdentifier());
            }
        };
        this.visitIdentifier = (context, optional = false) => {
            if (context.ID()) {
                return XDocASTNode_1.createIdentifierNode(context.ID().text, optional, []);
            }
        };
        /* Type visitor */
        this.visitType = (context, optional = false) => {
            // Intersections
            if (context.PIPE()) {
                return XDocASTNode_1.createTypeNode(XDocASTNode_1.createIntersectTypeNode(this.visitType(context instanceof Parser.TypeContext ? context.type(0) : context.notArrayType(0)), this.visitType(context instanceof Parser.TypeContext ? context.type(1) : context.notArrayType(1)), this.options.showNodeText ? context.text : undefined), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.AMP()) { // Unions
                return XDocASTNode_1.createTypeNode(XDocASTNode_1.createUnionTypeNode(this.visitType(context instanceof Parser.TypeContext ? context.type(0) : context.notArrayType(0)), this.visitType(context instanceof Parser.TypeContext ? context.type(1) : context.notArrayType(1)), this.options.showNodeText ? context.text : undefined), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.lambdaType()) { // Lambda functions i.e. (id) => type
                return XDocASTNode_1.createTypeNode(this.visitLambdaType(context.lambdaType()), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.tupleType()) { // id<type, type>
                return XDocASTNode_1.createTypeNode(this.visitTuple(context.tupleType()), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.primaryType()) { // Primary
                return XDocASTNode_1.createTypeNode(this.visitPrimaryType(context.primaryType()), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.parenthesizedType()) { // (expression)
                return XDocASTNode_1.createTypeNode(this.visitParenthesizedType(context.parenthesizedType(), optional), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.unaryType()) {
                return XDocASTNode_1.createTypeNode(this.visitUnaryType(context.unaryType()), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context.objectType()) { // { ... }
                return XDocASTNode_1.createTypeNode(this.visitObjectType(context.objectType()), optional, this.options.showNodeText ? context.text : undefined);
            }
            if (context instanceof Parser.TypeContext && context.arrayType()) { // [ ... ]
                return XDocASTNode_1.createTypeNode(this.visitArrayType(context.arrayType()), optional, this.options.showNodeText ? context.text : undefined);
            }
        };
        /* Lambda visitor */
        this.visitLambdaType = (context) => {
            if (context.formalParameterSequence()) {
                return XDocASTNode_1.createLambdaTypeNode(this.visitLambdaFormalParameterSequence(context.formalParameterSequence()), this.visitType(context.type(), !!context.QUESTION()), this.options.showNodeText ? context.text : undefined);
            }
            else if (context.parameter()) {
                return XDocASTNode_1.createLambdaTypeNode(this.visitLambdaFormalParameterSequence(context.parameter()), this.visitType(context.type(), !!context.QUESTION()), this.options.showNodeText ? context.text : undefined);
            }
            return XDocASTNode_1.createLambdaTypeNode(null, this.visitType(context.type(), !!context.QUESTION()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitLambdaFormalParameterSequence = (context) => {
            if (context instanceof Parser.ParameterContext) {
                return XDocASTNode_1.createFormalParemeterSequenceNode([this.visitParameter(context)]);
            }
            return XDocASTNode_1.createFormalParemeterSequenceNode(this.visitParameters(context.parameter()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitParameters = (contexts) => {
            return contexts.map(context => {
                return this.visitParameter(context);
            });
        };
        this.visitParameter = (context) => {
            let identifier = this.visitIdentifier(context.identifier());
            let type;
            if (context.type()) {
                type = this.visitType(context.type());
            }
            return XDocASTNode_1.createParameterNode(identifier, type, this.options.showNodeText ? context.text : undefined);
        };
        this.visitTuple = (context) => {
            let identifier;
            let types;
            if (context.identifier()) {
                identifier = this.visitIdentifier(context.identifier());
            }
            if (context.tupleTypeSequence()) {
                types = this.visitTupleSequenceOrExtendedTypes(context.tupleTypeSequence());
            }
            return XDocASTNode_1.createTupleTypeNode(identifier, types, this.options.showNodeText ? context.text : undefined);
        };
        this.visitTupleSequenceOrExtendedTypes = (context) => {
            let types = [];
            const mergeSequence = () => {
                types = [
                    ...types,
                    ..._.flattenDeep(context.tupleTypeSequence().map(this.visitTupleSequenceOrExtendedTypes.bind(this)))
                ];
            };
            if (context.EXTENDS()) {
                types.push(XDocASTNode_1.createTupleExtendedTypeNode(this.visitPrimaryType(context.primaryType(0)), this.visitPrimaryType(context.primaryType(1)), this.options.showNodeText ? context.text : undefined));
                if (context.tupleTypeSequence()) {
                    mergeSequence();
                }
                return types;
            }
            if (context.PIPE()) {
                types.push(XDocASTNode_1.createIntersectTypeNode(XDocASTNode_1.createTypeNode(this.visitPrimaryType(context.primaryType(0))), XDocASTNode_1.createTypeNode(this.visitPrimaryType(context.primaryType(1))), this.options.showNodeText ? context.text : undefined));
                if (context.tupleTypeSequence()) {
                    mergeSequence();
                }
                return types;
            }
            if (context.AMP()) {
                types.push(XDocASTNode_1.createUnionTypeNode(XDocASTNode_1.createTypeNode(this.visitPrimaryType(context.primaryType(0))), XDocASTNode_1.createTypeNode(this.visitPrimaryType(context.primaryType(1))), this.options.showNodeText ? context.text : undefined));
                if (context.tupleTypeSequence()) {
                    mergeSequence();
                }
                return types;
            }
            if (context.primaryType().length === 1) {
                types = context.primaryType()
                    .map(primary => XDocASTNode_1.createTypeNode(this.visitPrimaryType(primary)));
                if (context.tupleTypeSequence()) {
                    mergeSequence();
                }
                return types;
            }
        };
        this.visitPrimaryType = (context) => {
            let primary;
            if (context.optionalIdentifier()) {
                primary = this.visitOptionalIdentifier(context.optionalIdentifier());
            }
            else if (context.identifierOrKeyword()) {
                primary = this.visitIdentifierOrKeyword(context.identifierOrKeyword());
            }
            else if (context.propertyIdentifier()) {
                primary = this.visitPropertyIdentifier(context.propertyIdentifier());
            }
            return XDocASTNode_1.createPrimaryTypeNode(primary, this.options.showNodeText ? context.text : undefined);
        };
        this.visitIdentifierOrKeyword = (context) => {
            if (context.identifier()) {
                return this.visitIdentifier(context.identifier());
            }
            if (context.keyword()) {
                return this.visitKeyword(context.keyword());
            }
        };
        this.visitKeyword = (context) => {
            if (context.NullLiteral()) {
                return XDocASTNode_1.createKeywordNode(context.NullLiteral().text);
            }
        };
        this.visitParenthesizedType = (context, optional = false) => {
            if (context.type()) {
                return XDocASTNode_1.createParenthesizedTypeNode(this.visitType(context.type()), optional, this.options.showNodeText ? context.text : undefined);
            }
        };
        this.visitUnaryType = (context) => {
            return XDocASTNode_1.createUnaryTypeNode((context.AMP() || context.STAR()).text, this.visitPrimaryType(context.primaryType()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitObjectType = (context) => {
            return XDocASTNode_1.createObjectTypeNode(this.visitObjectPairSequenceType(context.objectPairSequenceType()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitObjectPairSequenceType = (context) => {
            return (context ? context.objectPairType() : []).map(pair => {
                return XDocASTNode_1.createObjectPairTypeNode(this.visitType(pair.type(0)), this.visitType(pair.type(1)), this.options.showNodeText ? pair.text : undefined);
            });
        };
        this.visitArrayType = (context) => {
            if (context.notArrayType()) {
                return XDocASTNode_1.createArrayTypeNode(this.visitType(context.notArrayType()), (context.type() || []).map(type => this.visitType(type)), this.options.showNodeText ? context.text : undefined);
            }
            return XDocASTNode_1.createArrayTypeNode(null, (context.type() || []).map(type => this.visitType(type)), this.options.showNodeText ? context.text : undefined);
        };
        this.visitPropertyIdentifier = (context) => {
            // Assume 'context' is defined.
            let identifier = context.identifier() ?
                this.visitIdentifier(context.identifier()) :
                this.visitOptionalIdentifier(context.optionalIdentifier());
            // A property must exist since by grammar:
            // (optionalIdentifier | identifier) ('.' optionalIdentifierOrIdentifier)+
            let property = context.optionalIdentifierOrIdentifier()
                .map(this.visitOptionalIdentifierOrIdentifier);
            // Add the identifier to the beginning of the array
            property.unshift(identifier);
            return XDocASTNode_1.createPropertyIdentifierNode(property, context.text);
        };
        this.visitOptionalIdentifier = (context) => {
            if (context.identifier()) {
                return this.visitIdentifier(context.identifier(), !!context.QUESTION());
            }
        };
        this.visitOptionalIdentifierOrIdentifier = (context) => {
            if (context.identifier()) {
                return this.visitIdentifier(context.identifier());
            }
            if (context.optionalIdentifier()) {
                return this.visitOptionalIdentifier(context.optionalIdentifier());
            }
        };
        /* Expression visitor */
        this.visitExpression = (context) => {
            if (context.unaryExpression()) {
                return XDocASTNode_1.createExpressionNode(this.visitUnaryExpression(context.unaryExpression()), this.options.showNodeText ? context.text : undefined);
            }
            if (context.expression().length > 1) {
                return XDocASTNode_1.createExpressionNode(XDocASTNode_1.createBinaryExpressionNode((context.PLUS() || context.MINUS() || context.STAR() || context.FORWARD_SLASH()).text, this.visitExpression(context.expression(0)), this.visitExpression(context.expression(1)), this.options.showNodeText ? context.text : undefined), this.options.showNodeText ? context.text : undefined);
            }
            if (context.arrayExpression()) {
                return XDocASTNode_1.createExpressionNode(XDocASTNode_1.createArrayExpressionNode(this.visitArrayExpression(context.arrayExpression()), this.options.showNodeText ? context.arrayExpression().text : undefined), this.options.showNodeText ? context.text : undefined);
            }
            if (context.objectExpression()) {
                return XDocASTNode_1.createExpressionNode(this.visitObjectExpression(context.objectExpression()), this.options.showNodeText ? context.text : undefined);
            }
            if (context.lambdaExpression()) {
                return XDocASTNode_1.createExpressionNode(this.visitLambdaExpression(context.lambdaExpression()), this.options.showNodeText ? context.text : undefined);
            }
            if (context.literalExpression()) {
                return XDocASTNode_1.createExpressionNode(this.visitLiteralExpression(context.literalExpression()), this.options.showNodeText ? context.text : undefined);
            }
            if (context.parenthesizedExpression()) {
                return XDocASTNode_1.createExpressionNode(this.visitParenthesizedExpression(context.parenthesizedExpression()), this.options.showNodeText ? context.text : undefined);
            }
        };
        this.visitUnaryExpression = (context) => {
            return XDocASTNode_1.createUnaryExpressionNode((context.PLUS() || context.MINUS()).text, this.visitExpression(context.expression()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitArrayExpression = (context) => {
            return (context ? context.expression() : []).map(expression => {
                return this.visitExpression(expression);
            });
        };
        this.visitObjectExpression = (context) => {
            return XDocASTNode_1.createObjectExpressionNode(this.visitObjectPairSequenceExpression(context.objectPairSequenceExpression()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitObjectPairSequenceExpression = (context) => {
            return (context ? context.objectPairExpression() : []).map(pair => {
                return XDocASTNode_1.createObjectPairExpressionNode(this.visitLiteralExpression(pair.literalExpression(0)), pair.objectExpression() ?
                    this.visitObjectExpression(pair.objectExpression()) :
                    this.visitLiteralExpression(pair.literalExpression(1)), this.options.showNodeText ? context.text : undefined);
            });
        };
        this.visitLambdaExpression = (context) => {
            return this.visitLambdaType(context);
        };
        this.visitParenthesizedExpression = (context) => {
            return XDocASTNode_1.createParenthesizedExpressioneNode(this.visitExpression(context.expression()));
        };
        this.visitLiteralExpression = (context) => {
            let node = { literal: {} };
            if (context.NumberLiteral()) {
                return XDocASTNode_1.createLiteralExpressionNode('number', context.NumberLiteral().text);
            }
            if (context.BooleanLiteral()) {
                return XDocASTNode_1.createLiteralExpressionNode('boolean', context.BooleanLiteral().text);
            }
            if (context.CharacterLiteral()) {
                return XDocASTNode_1.createLiteralExpressionNode('character', context.CharacterLiteral().text);
            }
            if (context.StringLiteral()) {
                return XDocASTNode_1.createLiteralExpressionNode('string', context.StringLiteral().text);
            }
            if (context.NullLiteral()) {
                return XDocASTNode_1.createLiteralExpressionNode('null', context.NullLiteral().text);
            }
        };
        /* Description visitor */
        this.visitDescription = (context) => {
            return XDocASTNode_1.createDescriptionNode(context.text, this.visitDescriptionLine(context.descriptionLine()));
        };
        this.visitDescriptionLine = (context) => {
            return this.visitDescriptionLineElement(context.descriptionLineElement());
        };
        this.visitDescriptionLineElement = (context) => {
            return (context || []).map(element => {
                return element.inlineTag() ? this.visitInlineTag(element.inlineTag()) : undefined;
            }).filter(element => element !== undefined);
        };
        this.visitInlineTag = (context) => {
            return XDocASTNode_1.createInlineTagNode(this.visitIdentifier(context.inlineTagName().identifier()), this.visitInlineTagBody(context.inlineTagBody()), this.options.showNodeText ? context.text : undefined);
        };
        this.visitInlineTagBody = (context) => {
            return context.braceBody().map(body => body.text).join('');
        };
        Object.assign(this.options, options);
        this.documentation = documentation;
    }
}
exports.default = XDocASTVisitor;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiWERvY0FTVFZpc2l0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvWERvY0FTVFZpc2l0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0QkFBNEI7QUFDNUIsNkNBQTZDO0FBQzdDLHFDQUFtQztBQUNuQywrQ0FrRXVCO0FBTXZCOzs7Ozs7Ozs7R0FTRztBQUNIO0lBTUUsWUFBWSxhQUEwQyxFQUFFLE9BQXdDO1FBSnhGLFlBQU8sR0FBMEI7WUFDdkMsWUFBWSxFQUFFLEtBQUs7U0FDcEIsQ0FBQTtRQU1EOzs7Ozs7Ozs7Ozs7Ozs7O1dBZ0JHO1FBQ0gsVUFBSyxHQUFHLEdBQStCLEVBQUU7WUFDdkMsT0FBTyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDO1FBQ3JELENBQUMsQ0FBQTtRQUNELDJCQUEyQjtRQUUzQix1QkFBa0IsR0FBRyxDQUNuQixPQUFvQyxFQUNSLEVBQUU7WUFDOUIsSUFBSSxPQUFPLENBQUMsSUFBSSxFQUFFLEVBQUU7Z0JBQ2xCLE9BQU8scUNBQXVCLENBQzVCLElBQUksQ0FBQyxTQUFTLENBQUMsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDLEVBQzlCLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ3JELENBQUE7YUFDRjtRQUNILENBQUMsQ0FBQTtRQUVELGNBQVMsR0FBRyxDQUNWLE9BQTJCLEVBQ1IsRUFBRTtZQUNyQixJQUFJLE9BQU8sQ0FBQyxXQUFXLEVBQUUsRUFBRTtnQkFDekIsT0FBTyw0QkFBYyxDQUNuQixJQUFJLENBQUMsZ0JBQWdCLENBQUMsT0FBTyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQzVDLElBQUksQ0FBQyxPQUFPLENBQUMsWUFBWSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQ3JE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QyxJQUFJLENBQUMsY0FBYyxDQUFDLE9BQU8sQ0FBQyxTQUFTLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUE7WUFDbkYsQ0FBQyxDQUFDLENBQUMsTUFBTSxDQUFDLE9BQU8sQ0FBQyxFQUFFLENBQUMsT0FBTyxLQUFLLFNBQVMsQ0FBQyxDQUFDO1FBQzlDLENBQUMsQ0FBQTtRQUVELG1CQUFjLEdBQUcsQ0FBQyxPQUFnQyxFQUEwQixFQUFFO1lBQzVFLE9BQU8saUNBQW1CLENBQ3hCLElBQUksQ0FBQyxlQUFlLENBQUMsT0FBTyxDQUFDLGFBQWEsRUFBRSxDQUFDLFVBQVUsRUFBRSxDQUFDLEVBQzFELElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxPQUFPLENBQUMsYUFBYSxFQUFFLENBQUMsRUFDaEQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsQ0FBQyxDQUFDLE9BQU8sQ0FBQyxJQUFJLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FDckQsQ0FBQztRQUNKLENBQUMsQ0FBQTtRQUVELHVCQUFrQixHQUFHLENBQUMsT0FBb0MsRUFBVSxFQUFFO1lBQ3BFLE9BQU8sT0FBTyxDQUFDLFNBQVMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7UUFDN0QsQ0FBQyxDQUFBO1FBOW1CQyxNQUFNLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxPQUFPLEVBQUUsT0FBTyxDQUFDLENBQUM7UUFDckMsSUFBSSxDQUFDLGFBQWEsR0FBRyxhQUFhLENBQUM7SUFDckMsQ0FBQztDQTZtQkY7QUF0bkJELGlDQXNuQkMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBQYXJzZXIgZnJvbSAnLi9YRG9jU3ludGF4UGFyc2VyJztcbmltcG9ydCAnLi9YRG9jU3ludGF4UGFyc2VyVmlzaXRvcic7XG5pbXBvcnQge1xuICBBbm5vdGF0aW9uc05vZGUsXG4gIEFycmF5VHlwZU5vZGUsXG4gIEJvZHlOb2RlLFxuICBjcmVhdGVBcnJheUV4cHJlc3Npb25Ob2RlLFxuICBjcmVhdGVBcnJheVR5cGVOb2RlLFxuICBjcmVhdGVCaW5hcnlFeHByZXNzaW9uTm9kZSxcbiAgY3JlYXRlQm9keU5vZGUsXG4gIGNyZWF0ZURlc2NyaXB0aW9uTm9kZSxcbiAgY3JlYXRlRG9jdW1lbnRhdGlvbk5vZGUsXG4gIGNyZWF0ZUV4cHJlc3Npb25Ob2RlLFxuICBjcmVhdGVGb3JtYWxQYXJlbWV0ZXJTZXF1ZW5jZU5vZGUsXG4gIGNyZWF0ZUlkZW50aWZpZXJOb2RlLFxuICBjcmVhdGVJbmxpbmVUYWdOb2RlLFxuICBjcmVhdGVJbnRlcnNlY3RUeXBlTm9kZSxcbiAgY3JlYXRlS2V5d29yZE5vZGUsXG4gIGNyZWF0ZUxhbWJkYVR5cGVOb2RlLFxuICBjcmVhdGVMaXRlcmFsRXhwcmVzc2lvbk5vZGUsXG4gIGNyZWF0ZU9iamVjdEV4cHJlc3Npb25Ob2RlLFxuICBjcmVhdGVPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGUsXG4gIGNyZWF0ZU9iamVjdFBhaXJUeXBlTm9kZSxcbiAgY3JlYXRlT2JqZWN0VHlwZU5vZGUsXG4gIGNyZWF0ZVBhcmFtZXRlck5vZGUsXG4gIGNyZWF0ZVBhcmVudGhlc2l6ZWRUeXBlTm9kZSxcbiAgY3JlYXRlUHJpbWFyeVR5cGVOb2RlLFxuICBjcmVhdGVQcm9wZXJ0eVRhZ0lkZW50aWZpZXJOb2RlLFxuICBjcmVhdGVQcm9wZXJ0eUlkZW50aWZpZXJOb2RlLFxuICBjcmVhdGVUYWdJZGVudGlmaWVyTm9kZSwgY3JlYXRlT3B0aW9uYWxUYWdJZGVudGlmaWVyTm9kZSxcbiAgY3JlYXRlVGFnTmFtZU5vZGUsXG4gIGNyZWF0ZVRhZ05vZGUsXG4gIGNyZWF0ZVR1cGxlVHlwZU5vZGUsXG4gIGNyZWF0ZVR5cGVOb2RlLFxuICBjcmVhdGVVbmFyeUV4cHJlc3Npb25Ob2RlLFxuICBjcmVhdGVVbmFyeVR5cGVOb2RlLFxuICBjcmVhdGVVbmlvblR5cGVOb2RlLFxuICBEZXNjcmlwdGlvbk5vZGUsXG4gIERvY3VtZW50YXRpb25Ob2RlLFxuICBFeHByZXNzaW9uTm9kZSxcbiAgRm9ybWFsUGFyYW1ldGVyU2VxdWVuY2VOb2RlLFxuICBJZGVudGlmaWVyTm9kZSxcbiAgSW5saW5lVGFnTm9kZSxcbiAgS2V5d29yZE5vZGUsXG4gIExhbWJkYUV4cHJlc3Npb25Ob2RlLFxuICBMYW1iZGFUeXBlTm9kZSxcbiAgTGl0ZXJhbEV4cHJlc3Npb25Ob2RlLFxuICBPYmplY3RFeHByZXNzaW9uTm9kZSxcbiAgT2JqZWN0UGFpckV4cHJlc3Npb25Ob2RlLFxuICBPcHRpb25hbElkZW50aWZpZXJOb2RlLFxuICBPcHRpb25hbFRhZ0lkZW50aWZpZXJOb2RlLFxuICBQYXJhbWV0ZXJOb2RlLFxuICBQYXJlbnRoZXNpemVkRXhwcmVzc2lvbk5vZGUsXG4gIFByb3BlcnR5VGFnSWRlbnRpZmllck5vZGUsXG4gIFRhZ0lkZW50aWZpZXJOb2RlLFxuICBUYWdOYW1lTm9kZSxcbiAgVGFnTm9kZSxcbiAgVHVwbGVUeXBlTm9kZSxcbiAgVHlwZU5vZGUsXG4gIFVuYXJ5RXhwcmVzc2lvbk5vZGUsXG4gIFByb3BlcnR5SWRlbnRpZmllck5vZGUsXG4gIFBhcmVudGhlc2l6ZWRUeXBlTm9kZSxcbiAgY3JlYXRlUGFyZW50aGVzaXplZEV4cHJlc3Npb25lTm9kZSxcbiAgUHJpbWFyeVR5cGVOb2RlLFxuICBVbmFyeVR5cGVOb2RlLFxuICBPYmplY3RUeXBlTm9kZSxcbiAgY3JlYXRlVHVwbGVFeHRlbmRlZFR5cGVOb2RlLFxuICBUdXBsZUV4dGVuZGVkVHlwZU5vZGUsXG59IGZyb20gJy4vWERvY0FTVE5vZGUnO1xuXG5cbmV4cG9ydCBpbnRlcmZhY2UgWERvY0FTVFZpc2l0b3JPcHRpb25zIHtcbiAgc2hvd05vZGVUZXh0OiBib29sZWFuXG59XG4vKipcbiAqIFhEb2NBU1QgaXMgYSBjbGFzcyB0aGF0IGNvbnZlcnRzIGEgQW50bHIgcGFyc2UgdHJlZVxuICogaW50byBhIEphdmFzY3JpcHQgdHJlZSBvYmplY3QuXG4gKiBcbiAqICMgQVBJXG4gKiBcbiAqIGBgYFxuICogQGNsYXNzIFhEb2NBU1RcbiAqIGBgYFxuICovXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBYRG9jQVNUVmlzaXRvciB7XG4gIHByaXZhdGUgZG9jdW1lbnRhdGlvbjogUGFyc2VyLkRvY3VtZW50YXRpb25Db250ZXh0XG4gIHByaXZhdGUgb3B0aW9uczogWERvY0FTVFZpc2l0b3JPcHRpb25zID0ge1xuICAgIHNob3dOb2RlVGV4dDogZmFsc2VcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGRvY3VtZW50YXRpb246IFBhcnNlci5Eb2N1bWVudGF0aW9uQ29udGV4dCwgb3B0aW9ucz86IFBhcnRpYWw8WERvY0FTVFZpc2l0b3JPcHRpb25zPikge1xuICAgIE9iamVjdC5hc3NpZ24odGhpcy5vcHRpb25zLCBvcHRpb25zKTtcbiAgICB0aGlzLmRvY3VtZW50YXRpb24gPSBkb2N1bWVudGF0aW9uO1xuICB9XG4gIC8qKlxuICAgKiBDb252ZXJ0cyB0aGUgQW50bHIgcGFyc2UgdHJlZSBpbnRvIGEgSmF2YVNjcmlwdCB0cmVlIG9iamVjdC5cbiAgICogXG4gICAqICMgQVBJXG4gICAqIFxuICAgKiBgYGBcbiAgICogQG1ldGhvZCB2aXNpdFxuICAgKiBAcGFyYW0gY29udGV4dDogUGFyc2VyLkRvY3VtZW50YXRpb25Db25leHRcbiAgICogQHJldHVybjogeyBcbiAgICogIG5hbWU/OiBzdHJpbmcsIFxuICAgKiAgaWQ/OiB7fSwgXG4gICAqICB2YWx1ZT86IHt9LCBcbiAgICogIHR5cGU/OiB7fSwgXG4gICAqICBkZXNjcmlwdGlvbj86IHt9IFxuICAgKiB9W11cbiAgICogYGBgXG4gICAqL1xuICB2aXNpdCA9ICgpOiBQYXJ0aWFsPERvY3VtZW50YXRpb25Ob2RlPiA9PiB7XG4gICAgcmV0dXJuIHRoaXMudmlzaXREb2N1bWVudGF0aW9uKHRoaXMuZG9jdW1lbnRhdGlvbik7XG4gIH1cbiAgLyogRG9jdW1lbnRhdGlvbiB2aXNpdG9yICovXG5cbiAgdmlzaXREb2N1bWVudGF0aW9uID0gKFxuICAgIGNvbnRleHQ6IFBhcnNlci5Eb2N1bWVudGF0aW9uQ29udGV4dFxuICApOiBQYXJ0aWFsPERvY3VtZW50YXRpb25Ob2RlPiA9PiB7XG4gICAgaWYgKGNvbnRleHQuYm9keSgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlRG9jdW1lbnRhdGlvbk5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRCb2R5KGNvbnRleHQuYm9keSgpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKVxuICAgIH1cbiAgfVxuXG4gIHZpc2l0Qm9keSA9IChcbiAgICBjb250ZXh0OiBQYXJzZXIuQm9keUNvbnRleHRcbiAgKTogUGFydGlhbDxCb2R5Tm9kZT4gPT4ge1xuICAgIGlmIChjb250ZXh0LmFubm90YXRpb25zKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVCb2R5Tm9kZShcbiAgICAgICAgdGhpcy52aXNpdEFubm90YXRpb25zKGNvbnRleHQuYW5ub3RhdGlvbnMoKSksXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgfVxuICB9XG5cbiAgdmlzaXRBbm5vdGF0aW9ucyA9IChcbiAgICBjb250ZXh0OiBQYXJzZXIuQW5ub3RhdGlvbnNDb250ZXh0LFxuICApOiBQYXJ0aWFsPEFubm90YXRpb25zTm9kZT4gPT4ge1xuICAgIGlmIChjb250ZXh0LnRhZygpKSB7XG4gICAgICByZXR1cm4gKGNvbnRleHQudGFnKCkgfHwgW10pLm1hcCh0aGlzLnZpc2l0VGFnKVxuICAgIH1cbiAgfVxuXG5cbiAgdmlzaXRUYWcgPSAoY29udGV4dDogUGFyc2VyLlRhZ0NvbnRleHQpOiBQYXJ0aWFsPFRhZ05vZGU+ID0+IHtcbiAgICBsZXQgbmFtZTogUGFydGlhbDxUYWdOYW1lTm9kZT4sXG4gICAgICBpZGVudGlmaWVyOiBQYXJ0aWFsPFRhZ0lkZW50aWZpZXJOb2RlPixcbiAgICAgIHR5cGU6IFBhcnRpYWw8VHlwZU5vZGU+LFxuICAgICAgZXhwcmVzc2lvbjogUGFydGlhbDxFeHByZXNzaW9uTm9kZT4sXG4gICAgICBkZXNjcmlwdGlvbjogUGFydGlhbDxEZXNjcmlwdGlvbk5vZGU+O1xuXG4gICAgaWYgKGNvbnRleHQudGFnTmFtZSgpKSB7XG4gICAgICBuYW1lID0gdGhpcy52aXNpdFRhZ05hbWUoY29udGV4dC50YWdOYW1lKCkpO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnRhZ0lkZW50aWZpZXIoKSkge1xuICAgICAgaWRlbnRpZmllciA9IHRoaXMudmlzaXRUYWdJZGVudGlmaWVyKGNvbnRleHQudGFnSWRlbnRpZmllcigpKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC50eXBlKCkpIHtcbiAgICAgIHR5cGUgPSB0aGlzLnZpc2l0VHlwZShjb250ZXh0LnR5cGUoKSk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuZXhwcmVzc2lvbigpKSB7XG4gICAgICBleHByZXNzaW9uID0gdGhpcy52aXNpdEV4cHJlc3Npb24oY29udGV4dC5leHByZXNzaW9uKCkpXG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuZGVzY3JpcHRpb24oKSkge1xuICAgICAgZGVzY3JpcHRpb24gPSB0aGlzLnZpc2l0RGVzY3JpcHRpb24oY29udGV4dC5kZXNjcmlwdGlvbigpKVxuICAgIH1cblxuICAgIHJldHVybiBjcmVhdGVUYWdOb2RlKG5hbWUsIGlkZW50aWZpZXIsIHR5cGUsIGV4cHJlc3Npb24sIGRlc2NyaXB0aW9uLCB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkKVxuICB9XG5cbiAgdmlzaXRUYWdOYW1lID0gKGNvbnRleHQ6IFBhcnNlci5UYWdOYW1lQ29udGV4dCk6IFBhcnRpYWw8VGFnTmFtZU5vZGU+ID0+IHtcbiAgICBpZiAoY29udGV4dC5pZGVudGlmaWVyKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVUYWdOYW1lTm9kZSh0aGlzLnZpc2l0SWRlbnRpZmllcihjb250ZXh0LmlkZW50aWZpZXIoKSksIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWQpO1xuICAgIH1cbiAgfVxuXG4gIHZpc2l0VGFnSWRlbnRpZmllciA9IChjb250ZXh0OiBQYXJzZXIuVGFnSWRlbnRpZmllckNvbnRleHQpOiBQYXJ0aWFsPFRhZ0lkZW50aWZpZXJOb2RlPiA9PiB7XG4gICAgbGV0IGlkZW50aWZpZXI6IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+IHwgUGFydGlhbDxPcHRpb25hbElkZW50aWZpZXJOb2RlPixcbiAgICAgIHByb3BlcnR5OiBQYXJ0aWFsPFByb3BlcnR5VGFnSWRlbnRpZmllck5vZGU+O1xuICAgIGlmIChjb250ZXh0LmlkZW50aWZpZXIoKSkge1xuICAgICAgaWRlbnRpZmllciA9IHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaWRlbnRpZmllcigpKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5vcHRpb25hbFRhZ0lkZW50aWZpZXIoKSkge1xuICAgICAgaWRlbnRpZmllciA9IHRoaXMudmlzaXRPcHRpb25hbFRhZ0lkZW50aWZlcihjb250ZXh0Lm9wdGlvbmFsVGFnSWRlbnRpZmllcigpKVxuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnByb3BlcnR5VGFnSWRlbnRpZmllcigpKSB7XG4gICAgICBwcm9wZXJ0eSA9IHRoaXMudmlzaXRQcm9wZXJ0eVRhZ0lkZW50aWZpZXIoY29udGV4dC5wcm9wZXJ0eVRhZ0lkZW50aWZpZXIoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNyZWF0ZVRhZ0lkZW50aWZpZXJOb2RlKGlkZW50aWZpZXIsIHByb3BlcnR5LCB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkKTtcbiAgfVxuXG4gIHZpc2l0UHJvcGVydHlUYWdJZGVudGlmaWVyID0gKGNvbnRleHQ6IFBhcnNlci5Qcm9wZXJ0eVRhZ0lkZW50aWZpZXJDb250ZXh0KTogUGFydGlhbDxQcm9wZXJ0eVRhZ0lkZW50aWZpZXJOb2RlPiA9PiB7XG5cbiAgICAvLyBBc3N1bWUgJ2NvbnRleHQnIGlzIGRlZmluZWQuXG4gICAgbGV0IGlkZW50aWZpZXIgPSBjb250ZXh0LmlkZW50aWZpZXIoKSA/XG4gICAgICB0aGlzLnZpc2l0SWRlbnRpZmllcihjb250ZXh0LmlkZW50aWZpZXIoKSkgOlxuICAgICAgdGhpcy52aXNpdE9wdGlvbmFsVGFnSWRlbnRpZmVyKGNvbnRleHQub3B0aW9uYWxUYWdJZGVudGlmaWVyKCkpO1xuICAgIC8vIEEgcHJvcGVydHkgbXVzdCBleGlzdCBzaW5jZSBieSBncmFtbWFyOlxuICAgIC8vIChvcHRpb25hbFRhZ0lkZW50aWZpZXIgfCBpZGVudGlmaWVyKSAoJy4nIG9wdGlvbmFsVGFnT3JJZGVudGlmaWVyKStcbiAgICBsZXQgcHJvcGVydHkgPSBjb250ZXh0Lm9wdGlvbmFsVGFnT3JJZGVudGlmaWVyKClcbiAgICAgIC5tYXAodGhpcy52aXNpdE9wdGlvbmFsVGFnT3JJZGVudGlmaWVyKTtcbiAgICAvLyBBZGQgdGhlIGlkZW50aWZpZXIgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgYXJyYXlcbiAgICBwcm9wZXJ0eS51bnNoaWZ0KGlkZW50aWZpZXIpO1xuICAgIHJldHVybiBjcmVhdGVQcm9wZXJ0eVRhZ0lkZW50aWZpZXJOb2RlKHByb3BlcnR5LCBjb250ZXh0LnRleHQpO1xuICB9XG5cbiAgdmlzaXRPcHRpb25hbFRhZ0lkZW50aWZlciA9IChjb250ZXh0OiBQYXJzZXIuT3B0aW9uYWxUYWdJZGVudGlmaWVyQ29udGV4dCk6IFBhcnRpYWw8T3B0aW9uYWxUYWdJZGVudGlmaWVyTm9kZT4gPT4ge1xuICAgIGlmIChjb250ZXh0Lm9wdGlvbmFsSWRlbnRpZmllcigpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlT3B0aW9uYWxUYWdJZGVudGlmaWVyTm9kZSh0aGlzLnZpc2l0T3B0aW9uYWxJZGVudGlmaWVyKGNvbnRleHQub3B0aW9uYWxJZGVudGlmaWVyKCkpKVxuICAgIH1cbiAgfVxuXG4gIHZpc2l0T3B0aW9uYWxUYWdPcklkZW50aWZpZXIgPSAoY29udGV4dDogUGFyc2VyLk9wdGlvbmFsVGFnT3JJZGVudGlmaWVyQ29udGV4dCk6IChQYXJ0aWFsPElkZW50aWZpZXJOb2RlPiB8IFBhcnRpYWw8T3B0aW9uYWxJZGVudGlmaWVyTm9kZT4pID0+IHtcbiAgICBpZiAoY29udGV4dC5pZGVudGlmaWVyKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnZpc2l0SWRlbnRpZmllcihjb250ZXh0LmlkZW50aWZpZXIoKSlcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5vcHRpb25hbFRhZ0lkZW50aWZpZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMudmlzaXRPcHRpb25hbFRhZ0lkZW50aWZlcihjb250ZXh0Lm9wdGlvbmFsVGFnSWRlbnRpZmllcigpKTtcbiAgICB9XG4gIH1cblxuXG4gIHZpc2l0SWRlbnRpZmllciA9IChjb250ZXh0OiBQYXJzZXIuSWRlbnRpZmllckNvbnRleHQsIG9wdGlvbmFsID0gZmFsc2UpOiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPiA9PiB7XG4gICAgaWYgKGNvbnRleHQuSUQoKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUlkZW50aWZpZXJOb2RlKGNvbnRleHQuSUQoKS50ZXh0LCBvcHRpb25hbCwgW10pO1xuICAgIH1cbiAgfVxuXG4gIC8qIFR5cGUgdmlzaXRvciAqL1xuXG4gIHZpc2l0VHlwZSA9IChjb250ZXh0OiBQYXJzZXIuVHlwZUNvbnRleHQgfCBQYXJzZXIuTm90QXJyYXlUeXBlQ29udGV4dCwgb3B0aW9uYWwgPSBmYWxzZSk6IFBhcnRpYWw8VHlwZU5vZGU+ID0+IHtcblxuICAgIC8vIEludGVyc2VjdGlvbnNcbiAgICBpZiAoY29udGV4dC5QSVBFKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVUeXBlTm9kZShcbiAgICAgICAgY3JlYXRlSW50ZXJzZWN0VHlwZU5vZGUoXG4gICAgICAgICAgdGhpcy52aXNpdFR5cGUoY29udGV4dCBpbnN0YW5jZW9mIFBhcnNlci5UeXBlQ29udGV4dCA/IGNvbnRleHQudHlwZSgwKSA6IGNvbnRleHQubm90QXJyYXlUeXBlKDApKSxcbiAgICAgICAgICB0aGlzLnZpc2l0VHlwZShjb250ZXh0IGluc3RhbmNlb2YgUGFyc2VyLlR5cGVDb250ZXh0ID8gY29udGV4dC50eXBlKDEpIDogY29udGV4dC5ub3RBcnJheVR5cGUoMSkpLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICAgKSxcbiAgICAgICAgb3B0aW9uYWwsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuQU1QKCkpIHsgLy8gVW5pb25zXG4gICAgICByZXR1cm4gY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgIGNyZWF0ZVVuaW9uVHlwZU5vZGUoXG4gICAgICAgICAgdGhpcy52aXNpdFR5cGUoY29udGV4dCBpbnN0YW5jZW9mIFBhcnNlci5UeXBlQ29udGV4dCA/IGNvbnRleHQudHlwZSgwKSA6IGNvbnRleHQubm90QXJyYXlUeXBlKDApKSxcbiAgICAgICAgICB0aGlzLnZpc2l0VHlwZShjb250ZXh0IGluc3RhbmNlb2YgUGFyc2VyLlR5cGVDb250ZXh0ID8gY29udGV4dC50eXBlKDEpIDogY29udGV4dC5ub3RBcnJheVR5cGUoMSkpLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICAgKSxcbiAgICAgICAgb3B0aW9uYWwsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQubGFtYmRhVHlwZSgpKSB7IC8vIExhbWJkYSBmdW5jdGlvbnMgaS5lLiAoaWQpID0+IHR5cGVcbiAgICAgIHJldHVybiBjcmVhdGVUeXBlTm9kZShcbiAgICAgICAgdGhpcy52aXNpdExhbWJkYVR5cGUoY29udGV4dC5sYW1iZGFUeXBlKCkpLFxuICAgICAgICBvcHRpb25hbCxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC50dXBsZVR5cGUoKSkgeyAvLyBpZDx0eXBlLCB0eXBlPlxuICAgICAgcmV0dXJuIGNyZWF0ZVR5cGVOb2RlKFxuICAgICAgICB0aGlzLnZpc2l0VHVwbGUoY29udGV4dC50dXBsZVR5cGUoKSksXG4gICAgICAgIG9wdGlvbmFsLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnByaW1hcnlUeXBlKCkpIHsgLy8gUHJpbWFyeVxuICAgICAgcmV0dXJuIGNyZWF0ZVR5cGVOb2RlKFxuICAgICAgICB0aGlzLnZpc2l0UHJpbWFyeVR5cGUoY29udGV4dC5wcmltYXJ5VHlwZSgpKSxcbiAgICAgICAgb3B0aW9uYWwsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQucGFyZW50aGVzaXplZFR5cGUoKSkgeyAvLyAoZXhwcmVzc2lvbilcbiAgICAgIHJldHVybiBjcmVhdGVUeXBlTm9kZShcbiAgICAgICAgdGhpcy52aXNpdFBhcmVudGhlc2l6ZWRUeXBlKGNvbnRleHQucGFyZW50aGVzaXplZFR5cGUoKSwgb3B0aW9uYWwpLFxuICAgICAgICBvcHRpb25hbCxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKVxuICAgIH1cblxuICAgIGlmIChjb250ZXh0LnVuYXJ5VHlwZSgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRVbmFyeVR5cGUoY29udGV4dC51bmFyeVR5cGUoKSksXG4gICAgICAgIG9wdGlvbmFsLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0Lm9iamVjdFR5cGUoKSkgeyAvLyB7IC4uLiB9XG4gICAgICByZXR1cm4gY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRPYmplY3RUeXBlKGNvbnRleHQub2JqZWN0VHlwZSgpKSxcbiAgICAgICAgb3B0aW9uYWwsXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICk7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQgaW5zdGFuY2VvZiBQYXJzZXIuVHlwZUNvbnRleHQgJiYgY29udGV4dC5hcnJheVR5cGUoKSkgeyAvLyBbIC4uLiBdXG4gICAgICByZXR1cm4gY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRBcnJheVR5cGUoY29udGV4dC5hcnJheVR5cGUoKSksXG4gICAgICAgIG9wdGlvbmFsLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApO1xuICAgIH1cbiAgfVxuXG4gIC8qIExhbWJkYSB2aXNpdG9yICovXG5cbiAgdmlzaXRMYW1iZGFUeXBlID0gKGNvbnRleHQ6IFBhcnNlci5MYW1iZGFUeXBlQ29udGV4dCk6IFBhcnRpYWw8TGFtYmRhVHlwZU5vZGU+ID0+IHtcbiAgICBpZiAoY29udGV4dC5mb3JtYWxQYXJhbWV0ZXJTZXF1ZW5jZSgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGFtYmRhVHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRMYW1iZGFGb3JtYWxQYXJhbWV0ZXJTZXF1ZW5jZShjb250ZXh0LmZvcm1hbFBhcmFtZXRlclNlcXVlbmNlKCkpLFxuICAgICAgICB0aGlzLnZpc2l0VHlwZShjb250ZXh0LnR5cGUoKSwgISFjb250ZXh0LlFVRVNUSU9OKCkpLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApO1xuXG4gICAgfSBlbHNlIGlmIChjb250ZXh0LnBhcmFtZXRlcigpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGFtYmRhVHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRMYW1iZGFGb3JtYWxQYXJhbWV0ZXJTZXF1ZW5jZShjb250ZXh0LnBhcmFtZXRlcigpKSxcbiAgICAgICAgdGhpcy52aXNpdFR5cGUoY29udGV4dC50eXBlKCksICEhY29udGV4dC5RVUVTVElPTigpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY3JlYXRlTGFtYmRhVHlwZU5vZGUoXG4gICAgICBudWxsLFxuICAgICAgdGhpcy52aXNpdFR5cGUoY29udGV4dC50eXBlKCksICEhY29udGV4dC5RVUVTVElPTigpKSxcbiAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICApXG4gIH1cblxuICB2aXNpdExhbWJkYUZvcm1hbFBhcmFtZXRlclNlcXVlbmNlID0gKGNvbnRleHQ6IFBhcnNlci5Gb3JtYWxQYXJhbWV0ZXJTZXF1ZW5jZUNvbnRleHQgfCBQYXJzZXIuUGFyYW1ldGVyQ29udGV4dCk6IFBhcnRpYWw8Rm9ybWFsUGFyYW1ldGVyU2VxdWVuY2VOb2RlPiA9PiB7XG4gICAgaWYgKGNvbnRleHQgaW5zdGFuY2VvZiBQYXJzZXIuUGFyYW1ldGVyQ29udGV4dCkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUZvcm1hbFBhcmVtZXRlclNlcXVlbmNlTm9kZShbdGhpcy52aXNpdFBhcmFtZXRlcihjb250ZXh0KV0pXG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVGb3JtYWxQYXJlbWV0ZXJTZXF1ZW5jZU5vZGUodGhpcy52aXNpdFBhcmFtZXRlcnMoY29udGV4dC5wYXJhbWV0ZXIoKSksIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWQpXG4gIH1cblxuICB2aXNpdFBhcmFtZXRlcnMgPSAoY29udGV4dHM6IFBhcnNlci5QYXJhbWV0ZXJDb250ZXh0W10pOiBQYXJ0aWFsPFBhcmFtZXRlck5vZGU+W10gPT4ge1xuICAgIHJldHVybiBjb250ZXh0cy5tYXAoY29udGV4dCA9PiB7XG4gICAgICByZXR1cm4gdGhpcy52aXNpdFBhcmFtZXRlcihjb250ZXh0KTtcbiAgICB9KVxuICB9XG5cbiAgdmlzaXRQYXJhbWV0ZXIgPSAoY29udGV4dDogUGFyc2VyLlBhcmFtZXRlckNvbnRleHQpOiBQYXJ0aWFsPFBhcmFtZXRlck5vZGU+ID0+IHtcbiAgICBsZXQgaWRlbnRpZmllciA9IHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaWRlbnRpZmllcigpKTtcbiAgICBsZXQgdHlwZTogVHlwZU5vZGVcbiAgICBpZiAoY29udGV4dC50eXBlKCkpIHtcbiAgICAgIHR5cGUgPSB0aGlzLnZpc2l0VHlwZShjb250ZXh0LnR5cGUoKSk7XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVQYXJhbWV0ZXJOb2RlKGlkZW50aWZpZXIsIHR5cGUsIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWQpO1xuICB9XG5cbiAgdmlzaXRUdXBsZSA9IChjb250ZXh0OiBQYXJzZXIuVHVwbGVUeXBlQ29udGV4dCk6IFBhcnRpYWw8VHVwbGVUeXBlTm9kZT4gPT4ge1xuICAgIGxldCBpZGVudGlmaWVyOiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPlxuICAgIGxldCB0eXBlczogUGFydGlhbDxUeXBlTm9kZT5bXVxuICAgIGlmIChjb250ZXh0LmlkZW50aWZpZXIoKSkge1xuICAgICAgaWRlbnRpZmllciA9IHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaWRlbnRpZmllcigpKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC50dXBsZVR5cGVTZXF1ZW5jZSgpKSB7XG4gICAgICB0eXBlcyA9IHRoaXMudmlzaXRUdXBsZVNlcXVlbmNlT3JFeHRlbmRlZFR5cGVzKGNvbnRleHQudHVwbGVUeXBlU2VxdWVuY2UoKSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNyZWF0ZVR1cGxlVHlwZU5vZGUoaWRlbnRpZmllciwgdHlwZXMsIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWQpO1xuICB9XG5cbiAgdmlzaXRUdXBsZVNlcXVlbmNlT3JFeHRlbmRlZFR5cGVzID0gKGNvbnRleHQ6IFBhcnNlci5UdXBsZVR5cGVTZXF1ZW5jZUNvbnRleHQpOiBQYXJ0aWFsPFR5cGVOb2RlIHwgVHVwbGVFeHRlbmRlZFR5cGVOb2RlPltdIHwgdW5kZWZpbmVkW10gPT4ge1xuICAgIGxldCB0eXBlcyA9IFtdO1xuXG4gICAgY29uc3QgbWVyZ2VTZXF1ZW5jZSA9ICgpID0+IHtcbiAgICAgIHR5cGVzID0gW1xuICAgICAgICAuLi50eXBlcywgXG4gICAgICAgIC4uLl8uZmxhdHRlbkRlZXAoXG4gICAgICAgICAgY29udGV4dC50dXBsZVR5cGVTZXF1ZW5jZSgpLm1hcCh0aGlzLnZpc2l0VHVwbGVTZXF1ZW5jZU9yRXh0ZW5kZWRUeXBlcy5iaW5kKHRoaXMpKSlcbiAgICAgIF1cbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5FWFRFTkRTKCkpIHtcbiAgICAgIHR5cGVzLnB1c2goY3JlYXRlVHVwbGVFeHRlbmRlZFR5cGVOb2RlKFxuICAgICAgICB0aGlzLnZpc2l0UHJpbWFyeVR5cGUoY29udGV4dC5wcmltYXJ5VHlwZSgwKSksXG4gICAgICAgIHRoaXMudmlzaXRQcmltYXJ5VHlwZShjb250ZXh0LnByaW1hcnlUeXBlKDEpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKSk7XG5cbiAgICAgIGlmIChjb250ZXh0LnR1cGxlVHlwZVNlcXVlbmNlKCkpIHtcbiAgICAgICAgbWVyZ2VTZXF1ZW5jZSgpO1xuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHlwZXM7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuUElQRSgpKSB7XG4gICAgICB0eXBlcy5wdXNoKGNyZWF0ZUludGVyc2VjdFR5cGVOb2RlKFxuICAgICAgICBjcmVhdGVUeXBlTm9kZShcbiAgICAgICAgICB0aGlzLnZpc2l0UHJpbWFyeVR5cGUoY29udGV4dC5wcmltYXJ5VHlwZSgwKSlcbiAgICAgICAgKSxcbiAgICAgICAgY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgICAgdGhpcy52aXNpdFByaW1hcnlUeXBlKGNvbnRleHQucHJpbWFyeVR5cGUoMSkpXG4gICAgICAgICksXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgICkpO1xuXG4gICAgICBpZiAoY29udGV4dC50dXBsZVR5cGVTZXF1ZW5jZSgpKSB7XG4gICAgICAgIG1lcmdlU2VxdWVuY2UoKVxuICAgICAgfVxuXG4gICAgICByZXR1cm4gdHlwZXM7XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuQU1QKCkpIHtcbiAgICAgIHR5cGVzLnB1c2goY3JlYXRlVW5pb25UeXBlTm9kZShcbiAgICAgICAgY3JlYXRlVHlwZU5vZGUoXG4gICAgICAgICAgdGhpcy52aXNpdFByaW1hcnlUeXBlKGNvbnRleHQucHJpbWFyeVR5cGUoMCkpXG4gICAgICAgICksXG4gICAgICAgIGNyZWF0ZVR5cGVOb2RlKFxuICAgICAgICAgIHRoaXMudmlzaXRQcmltYXJ5VHlwZShjb250ZXh0LnByaW1hcnlUeXBlKDEpKVxuICAgICAgICApLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApKTtcblxuICAgICAgaWYgKGNvbnRleHQudHVwbGVUeXBlU2VxdWVuY2UoKSkge1xuICAgICAgICBtZXJnZVNlcXVlbmNlKCk7XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB0eXBlcztcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5wcmltYXJ5VHlwZSgpLmxlbmd0aCA9PT0gMSkge1xuICAgICAgdHlwZXMgPSBjb250ZXh0LnByaW1hcnlUeXBlKClcbiAgICAgICAgLm1hcChwcmltYXJ5ID0+IGNyZWF0ZVR5cGVOb2RlKHRoaXMudmlzaXRQcmltYXJ5VHlwZShwcmltYXJ5KSkpXG5cbiAgICAgIGlmIChjb250ZXh0LnR1cGxlVHlwZVNlcXVlbmNlKCkpIHtcbiAgICAgICAgbWVyZ2VTZXF1ZW5jZSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHR5cGVzO1xuICAgIH1cbiAgfVxuXG4gIHZpc2l0UHJpbWFyeVR5cGUgPSAoY29udGV4dDogUGFyc2VyLlByaW1hcnlUeXBlQ29udGV4dCk6IFBhcnRpYWw8UHJpbWFyeVR5cGVOb2RlPiA9PiB7XG5cbiAgICBsZXQgcHJpbWFyeTogUGFydGlhbDxJZGVudGlmaWVyTm9kZT4gfCBQYXJ0aWFsPEtleXdvcmROb2RlPiB8IFBhcnRpYWw8UHJvcGVydHlJZGVudGlmaWVyTm9kZT47XG5cbiAgICBpZiAoY29udGV4dC5vcHRpb25hbElkZW50aWZpZXIoKSkge1xuICAgICAgcHJpbWFyeSA9IHRoaXMudmlzaXRPcHRpb25hbElkZW50aWZpZXIoY29udGV4dC5vcHRpb25hbElkZW50aWZpZXIoKSk7XG4gICAgfSBlbHNlIGlmIChjb250ZXh0LmlkZW50aWZpZXJPcktleXdvcmQoKSkge1xuICAgICAgcHJpbWFyeSA9IHRoaXMudmlzaXRJZGVudGlmaWVyT3JLZXl3b3JkKGNvbnRleHQuaWRlbnRpZmllck9yS2V5d29yZCgpKVxuICAgIH0gZWxzZSBpZiAoY29udGV4dC5wcm9wZXJ0eUlkZW50aWZpZXIoKSkge1xuICAgICAgcHJpbWFyeSA9IHRoaXMudmlzaXRQcm9wZXJ0eUlkZW50aWZpZXIoY29udGV4dC5wcm9wZXJ0eUlkZW50aWZpZXIoKSk7XG4gICAgfVxuICAgIHJldHVybiBjcmVhdGVQcmltYXJ5VHlwZU5vZGUocHJpbWFyeSwgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZCk7XG4gIH1cblxuICB2aXNpdElkZW50aWZpZXJPcktleXdvcmQgPSAoY29udGV4dDogUGFyc2VyLklkZW50aWZpZXJPcktleXdvcmRDb250ZXh0KTogUGFydGlhbDwoSWRlbnRpZmllck5vZGUgfCBLZXl3b3JkTm9kZSk+ID0+IHtcbiAgICBpZiAoY29udGV4dC5pZGVudGlmaWVyKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnZpc2l0SWRlbnRpZmllcihjb250ZXh0LmlkZW50aWZpZXIoKSlcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5rZXl3b3JkKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnZpc2l0S2V5d29yZChjb250ZXh0LmtleXdvcmQoKSlcbiAgICB9XG4gIH1cblxuICB2aXNpdEtleXdvcmQgPSAoY29udGV4dDogUGFyc2VyLktleXdvcmRDb250ZXh0KTogS2V5d29yZE5vZGUgPT4ge1xuICAgIGlmIChjb250ZXh0Lk51bGxMaXRlcmFsKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVLZXl3b3JkTm9kZShjb250ZXh0Lk51bGxMaXRlcmFsKCkudGV4dCk7XG4gICAgfVxuICB9XG5cbiAgdmlzaXRQYXJlbnRoZXNpemVkVHlwZSA9IChjb250ZXh0OiBQYXJzZXIuUGFyZW50aGVzaXplZFR5cGVDb250ZXh0LCBvcHRpb25hbCA9IGZhbHNlKTogUGFydGlhbDxQYXJlbnRoZXNpemVkVHlwZU5vZGU+ID0+IHtcbiAgICBpZiAoY29udGV4dC50eXBlKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVQYXJlbnRoZXNpemVkVHlwZU5vZGUodGhpcy52aXNpdFR5cGUoY29udGV4dC50eXBlKCkpLCBvcHRpb25hbCwgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZCk7XG4gICAgfVxuICB9XG5cbiAgdmlzaXRVbmFyeVR5cGUgPSAoY29udGV4dDogUGFyc2VyLlVuYXJ5VHlwZUNvbnRleHQpOiBQYXJ0aWFsPFVuYXJ5VHlwZU5vZGU+ID0+IHtcbiAgICByZXR1cm4gY3JlYXRlVW5hcnlUeXBlTm9kZShcbiAgICAgIChjb250ZXh0LkFNUCgpIHx8IGNvbnRleHQuU1RBUigpKS50ZXh0LFxuICAgICAgdGhpcy52aXNpdFByaW1hcnlUeXBlKGNvbnRleHQucHJpbWFyeVR5cGUoKSksXG4gICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgKTtcbiAgfVxuXG4gIHZpc2l0T2JqZWN0VHlwZSA9IChjb250ZXh0OiBQYXJzZXIuT2JqZWN0VHlwZUNvbnRleHQpOiBQYXJ0aWFsPE9iamVjdFR5cGVOb2RlPiA9PiB7XG4gICAgcmV0dXJuIGNyZWF0ZU9iamVjdFR5cGVOb2RlKHRoaXMudmlzaXRPYmplY3RQYWlyU2VxdWVuY2VUeXBlKGNvbnRleHQub2JqZWN0UGFpclNlcXVlbmNlVHlwZSgpKSwgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZCk7XG4gIH1cblxuICB2aXNpdE9iamVjdFBhaXJTZXF1ZW5jZVR5cGUgPSAoY29udGV4dDogUGFyc2VyLk9iamVjdFBhaXJTZXF1ZW5jZVR5cGVDb250ZXh0KSA9PiB7XG4gICAgcmV0dXJuIChjb250ZXh0ID8gY29udGV4dC5vYmplY3RQYWlyVHlwZSgpIDogW10pLm1hcChwYWlyID0+IHtcbiAgICAgIHJldHVybiBjcmVhdGVPYmplY3RQYWlyVHlwZU5vZGUodGhpcy52aXNpdFR5cGUocGFpci50eXBlKDApKSwgdGhpcy52aXNpdFR5cGUocGFpci50eXBlKDEpKSwgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IHBhaXIudGV4dCA6IHVuZGVmaW5lZClcbiAgICB9KTtcbiAgfVxuXG4gIHZpc2l0QXJyYXlUeXBlID0gKGNvbnRleHQ6IFBhcnNlci5BcnJheVR5cGVDb250ZXh0KTogUGFydGlhbDxBcnJheVR5cGVOb2RlPiA9PiB7XG5cbiAgICBpZiAoY29udGV4dC5ub3RBcnJheVR5cGUoKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUFycmF5VHlwZU5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRUeXBlKGNvbnRleHQubm90QXJyYXlUeXBlKCkpLFxuICAgICAgICAoY29udGV4dC50eXBlKCkgfHwgW10pLm1hcCh0eXBlID0+IHRoaXMudmlzaXRUeXBlKHR5cGUpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGNyZWF0ZUFycmF5VHlwZU5vZGUoXG4gICAgICBudWxsLFxuICAgICAgKGNvbnRleHQudHlwZSgpIHx8IFtdKS5tYXAodHlwZSA9PiB0aGlzLnZpc2l0VHlwZSh0eXBlKSksXG4gICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgKVxuICB9XG5cbiAgdmlzaXRQcm9wZXJ0eUlkZW50aWZpZXIgPSAoY29udGV4dDogUGFyc2VyLlByb3BlcnR5SWRlbnRpZmllckNvbnRleHQpOiBQYXJ0aWFsPFByb3BlcnR5SWRlbnRpZmllck5vZGU+ID0+IHtcblxuICAgIC8vIEFzc3VtZSAnY29udGV4dCcgaXMgZGVmaW5lZC5cbiAgICBsZXQgaWRlbnRpZmllciA9IGNvbnRleHQuaWRlbnRpZmllcigpID9cbiAgICAgIHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaWRlbnRpZmllcigpKSA6XG4gICAgICB0aGlzLnZpc2l0T3B0aW9uYWxJZGVudGlmaWVyKGNvbnRleHQub3B0aW9uYWxJZGVudGlmaWVyKCkpO1xuICAgIC8vIEEgcHJvcGVydHkgbXVzdCBleGlzdCBzaW5jZSBieSBncmFtbWFyOlxuICAgIC8vIChvcHRpb25hbElkZW50aWZpZXIgfCBpZGVudGlmaWVyKSAoJy4nIG9wdGlvbmFsSWRlbnRpZmllck9ySWRlbnRpZmllcikrXG4gICAgbGV0IHByb3BlcnR5ID0gY29udGV4dC5vcHRpb25hbElkZW50aWZpZXJPcklkZW50aWZpZXIoKVxuICAgICAgLm1hcCh0aGlzLnZpc2l0T3B0aW9uYWxJZGVudGlmaWVyT3JJZGVudGlmaWVyKTtcbiAgICAvLyBBZGQgdGhlIGlkZW50aWZpZXIgdG8gdGhlIGJlZ2lubmluZyBvZiB0aGUgYXJyYXlcbiAgICBwcm9wZXJ0eS51bnNoaWZ0KGlkZW50aWZpZXIpO1xuICAgIHJldHVybiBjcmVhdGVQcm9wZXJ0eUlkZW50aWZpZXJOb2RlKHByb3BlcnR5LCBjb250ZXh0LnRleHQpXG4gIH1cblxuICB2aXNpdE9wdGlvbmFsSWRlbnRpZmllciA9IChjb250ZXh0OiBQYXJzZXIuT3B0aW9uYWxJZGVudGlmaWVyQ29udGV4dCk6IFBhcnRpYWw8T3B0aW9uYWxJZGVudGlmaWVyTm9kZT4gPT4ge1xuICAgIGlmIChjb250ZXh0LmlkZW50aWZpZXIoKSkge1xuICAgICAgcmV0dXJuIHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaWRlbnRpZmllcigpLCAhIWNvbnRleHQuUVVFU1RJT04oKSlcbiAgICB9XG4gIH1cblxuICB2aXNpdE9wdGlvbmFsSWRlbnRpZmllck9ySWRlbnRpZmllciA9IChjb250ZXh0OiBQYXJzZXIuT3B0aW9uYWxJZGVudGlmaWVyT3JJZGVudGlmaWVyQ29udGV4dCk6IFBhcnRpYWw8T3B0aW9uYWxJZGVudGlmaWVyTm9kZT4gfCBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPiA9PiB7XG4gICAgaWYgKGNvbnRleHQuaWRlbnRpZmllcigpKSB7XG4gICAgICByZXR1cm4gdGhpcy52aXNpdElkZW50aWZpZXIoY29udGV4dC5pZGVudGlmaWVyKCkpXG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQub3B0aW9uYWxJZGVudGlmaWVyKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnZpc2l0T3B0aW9uYWxJZGVudGlmaWVyKGNvbnRleHQub3B0aW9uYWxJZGVudGlmaWVyKCkpXG4gICAgfVxuICB9XG5cbiAgLyogRXhwcmVzc2lvbiB2aXNpdG9yICovXG5cbiAgdmlzaXRFeHByZXNzaW9uID0gKGNvbnRleHQ6IFBhcnNlci5FeHByZXNzaW9uQ29udGV4dCk6IFBhcnRpYWw8RXhwcmVzc2lvbk5vZGU+ID0+IHtcbiAgICBpZiAoY29udGV4dC51bmFyeUV4cHJlc3Npb24oKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUV4cHJlc3Npb25Ob2RlKFxuICAgICAgICB0aGlzLnZpc2l0VW5hcnlFeHByZXNzaW9uKGNvbnRleHQudW5hcnlFeHByZXNzaW9uKCkpLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuZXhwcmVzc2lvbigpLmxlbmd0aCA+IDEpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFeHByZXNzaW9uTm9kZShcbiAgICAgICAgY3JlYXRlQmluYXJ5RXhwcmVzc2lvbk5vZGUoXG4gICAgICAgICAgKGNvbnRleHQuUExVUygpIHx8IGNvbnRleHQuTUlOVVMoKSB8fCBjb250ZXh0LlNUQVIoKSB8fCBjb250ZXh0LkZPUldBUkRfU0xBU0goKSkudGV4dCxcbiAgICAgICAgICB0aGlzLnZpc2l0RXhwcmVzc2lvbihjb250ZXh0LmV4cHJlc3Npb24oMCkpLFxuICAgICAgICAgIHRoaXMudmlzaXRFeHByZXNzaW9uKGNvbnRleHQuZXhwcmVzc2lvbigxKSksXG4gICAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgICApLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQuYXJyYXlFeHByZXNzaW9uKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFeHByZXNzaW9uTm9kZShcbiAgICAgICAgY3JlYXRlQXJyYXlFeHByZXNzaW9uTm9kZShcbiAgICAgICAgICB0aGlzLnZpc2l0QXJyYXlFeHByZXNzaW9uKGNvbnRleHQuYXJyYXlFeHByZXNzaW9uKCkpLFxuICAgICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LmFycmF5RXhwcmVzc2lvbigpLnRleHQgOiB1bmRlZmluZWRcbiAgICAgICAgKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKTtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5vYmplY3RFeHByZXNzaW9uKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFeHByZXNzaW9uTm9kZShcbiAgICAgICAgdGhpcy52aXNpdE9iamVjdEV4cHJlc3Npb24oY29udGV4dC5vYmplY3RFeHByZXNzaW9uKCkpLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApXG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQubGFtYmRhRXhwcmVzc2lvbigpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlRXhwcmVzc2lvbk5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRMYW1iZGFFeHByZXNzaW9uKGNvbnRleHQubGFtYmRhRXhwcmVzc2lvbigpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKVxuICAgIH1cblxuICAgIGlmIChjb250ZXh0LmxpdGVyYWxFeHByZXNzaW9uKCkpIHtcbiAgICAgIHJldHVybiBjcmVhdGVFeHByZXNzaW9uTm9kZShcbiAgICAgICAgdGhpcy52aXNpdExpdGVyYWxFeHByZXNzaW9uKGNvbnRleHQubGl0ZXJhbEV4cHJlc3Npb24oKSksXG4gICAgICAgIHRoaXMub3B0aW9ucy5zaG93Tm9kZVRleHQgPyBjb250ZXh0LnRleHQgOiB1bmRlZmluZWRcbiAgICAgIClcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5wYXJlbnRoZXNpemVkRXhwcmVzc2lvbigpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlRXhwcmVzc2lvbk5vZGUoXG4gICAgICAgIHRoaXMudmlzaXRQYXJlbnRoZXNpemVkRXhwcmVzc2lvbihjb250ZXh0LnBhcmVudGhlc2l6ZWRFeHByZXNzaW9uKCkpLFxuICAgICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgICApXG4gICAgfVxuICB9XG5cbiAgdmlzaXRVbmFyeUV4cHJlc3Npb24gPSAoY29udGV4dDogUGFyc2VyLlVuYXJ5RXhwcmVzc2lvbkNvbnRleHQpOiBQYXJ0aWFsPFVuYXJ5RXhwcmVzc2lvbk5vZGU+ID0+IHtcbiAgICByZXR1cm4gY3JlYXRlVW5hcnlFeHByZXNzaW9uTm9kZShcbiAgICAgIChjb250ZXh0LlBMVVMoKSB8fCBjb250ZXh0Lk1JTlVTKCkpLnRleHQsXG4gICAgICB0aGlzLnZpc2l0RXhwcmVzc2lvbihjb250ZXh0LmV4cHJlc3Npb24oKSksXG4gICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgKVxuICB9XG5cbiAgdmlzaXRBcnJheUV4cHJlc3Npb24gPSAoY29udGV4dDogUGFyc2VyLkFycmF5RXhwcmVzc2lvbkNvbnRleHQpOiBQYXJ0aWFsPEV4cHJlc3Npb25Ob2RlPltdID0+IHtcbiAgICByZXR1cm4gKGNvbnRleHQgPyBjb250ZXh0LmV4cHJlc3Npb24oKSA6IFtdKS5tYXAoZXhwcmVzc2lvbiA9PiB7XG4gICAgICByZXR1cm4gdGhpcy52aXNpdEV4cHJlc3Npb24oZXhwcmVzc2lvbilcbiAgICB9KVxuICB9XG5cbiAgdmlzaXRPYmplY3RFeHByZXNzaW9uID0gKGNvbnRleHQ6IFBhcnNlci5PYmplY3RFeHByZXNzaW9uQ29udGV4dCk6IFBhcnRpYWw8T2JqZWN0RXhwcmVzc2lvbk5vZGU+ID0+IHtcbiAgICByZXR1cm4gY3JlYXRlT2JqZWN0RXhwcmVzc2lvbk5vZGUoXG4gICAgICB0aGlzLnZpc2l0T2JqZWN0UGFpclNlcXVlbmNlRXhwcmVzc2lvbihjb250ZXh0Lm9iamVjdFBhaXJTZXF1ZW5jZUV4cHJlc3Npb24oKSksXG4gICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgKVxuICB9XG5cblxuICB2aXNpdE9iamVjdFBhaXJTZXF1ZW5jZUV4cHJlc3Npb24gPSAoY29udGV4dDogUGFyc2VyLk9iamVjdFBhaXJTZXF1ZW5jZUV4cHJlc3Npb25Db250ZXh0KTogUGFydGlhbDxPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGU+W10gPT4ge1xuICAgIHJldHVybiAoY29udGV4dCA/IGNvbnRleHQub2JqZWN0UGFpckV4cHJlc3Npb24oKSA6IFtdKS5tYXAocGFpciA9PiB7XG4gICAgICByZXR1cm4gY3JlYXRlT2JqZWN0UGFpckV4cHJlc3Npb25Ob2RlKFxuICAgICAgICB0aGlzLnZpc2l0TGl0ZXJhbEV4cHJlc3Npb24ocGFpci5saXRlcmFsRXhwcmVzc2lvbigwKSksXG4gICAgICAgIHBhaXIub2JqZWN0RXhwcmVzc2lvbigpID9cbiAgICAgICAgICB0aGlzLnZpc2l0T2JqZWN0RXhwcmVzc2lvbihwYWlyLm9iamVjdEV4cHJlc3Npb24oKSkgOlxuICAgICAgICAgIHRoaXMudmlzaXRMaXRlcmFsRXhwcmVzc2lvbihwYWlyLmxpdGVyYWxFeHByZXNzaW9uKDEpKSxcbiAgICAgICAgdGhpcy5vcHRpb25zLnNob3dOb2RlVGV4dCA/IGNvbnRleHQudGV4dCA6IHVuZGVmaW5lZFxuICAgICAgKVxuICAgIH0pO1xuICB9XG5cbiAgdmlzaXRMYW1iZGFFeHByZXNzaW9uID0gKGNvbnRleHQ6IFBhcnNlci5MYW1iZGFFeHByZXNzaW9uQ29udGV4dCk6IFBhcnRpYWw8TGFtYmRhRXhwcmVzc2lvbk5vZGU+ID0+IHtcbiAgICByZXR1cm4gdGhpcy52aXNpdExhbWJkYVR5cGUoY29udGV4dCk7XG4gIH1cblxuICB2aXNpdFBhcmVudGhlc2l6ZWRFeHByZXNzaW9uID0gKGNvbnRleHQ6IFBhcnNlci5QYXJlbnRoZXNpemVkRXhwcmVzc2lvbkNvbnRleHQpOiBQYXJ0aWFsPFBhcmVudGhlc2l6ZWRFeHByZXNzaW9uTm9kZT4gPT4ge1xuICAgIHJldHVybiBjcmVhdGVQYXJlbnRoZXNpemVkRXhwcmVzc2lvbmVOb2RlKHRoaXMudmlzaXRFeHByZXNzaW9uKGNvbnRleHQuZXhwcmVzc2lvbigpKSk7XG4gIH1cblxuICB2aXNpdExpdGVyYWxFeHByZXNzaW9uID0gKGNvbnRleHQ6IFBhcnNlci5MaXRlcmFsRXhwcmVzc2lvbkNvbnRleHQpOiBQYXJ0aWFsPExpdGVyYWxFeHByZXNzaW9uTm9kZT4gPT4ge1xuICAgIGxldCBub2RlID0geyBsaXRlcmFsOiB7fSB9XG4gICAgaWYgKGNvbnRleHQuTnVtYmVyTGl0ZXJhbCgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGl0ZXJhbEV4cHJlc3Npb25Ob2RlKFxuICAgICAgICAnbnVtYmVyJyxcbiAgICAgICAgY29udGV4dC5OdW1iZXJMaXRlcmFsKCkudGV4dFxuICAgICAgKVxuICAgIH1cbiAgICBpZiAoY29udGV4dC5Cb29sZWFuTGl0ZXJhbCgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGl0ZXJhbEV4cHJlc3Npb25Ob2RlKCdib29sZWFuJywgY29udGV4dC5Cb29sZWFuTGl0ZXJhbCgpLnRleHQpXG4gICAgfVxuICAgIGlmIChjb250ZXh0LkNoYXJhY3RlckxpdGVyYWwoKSkge1xuICAgICAgcmV0dXJuIGNyZWF0ZUxpdGVyYWxFeHByZXNzaW9uTm9kZSgnY2hhcmFjdGVyJywgY29udGV4dC5DaGFyYWN0ZXJMaXRlcmFsKCkudGV4dClcbiAgICB9XG4gICAgaWYgKGNvbnRleHQuU3RyaW5nTGl0ZXJhbCgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGl0ZXJhbEV4cHJlc3Npb25Ob2RlKCdzdHJpbmcnLCBjb250ZXh0LlN0cmluZ0xpdGVyYWwoKS50ZXh0KVxuICAgIH1cbiAgICBpZiAoY29udGV4dC5OdWxsTGl0ZXJhbCgpKSB7XG4gICAgICByZXR1cm4gY3JlYXRlTGl0ZXJhbEV4cHJlc3Npb25Ob2RlKCdudWxsJywgY29udGV4dC5OdWxsTGl0ZXJhbCgpLnRleHQpXG4gICAgfVxuICB9XG5cbiAgLyogRGVzY3JpcHRpb24gdmlzaXRvciAqL1xuXG4gIHZpc2l0RGVzY3JpcHRpb24gPSAoY29udGV4dDogUGFyc2VyLkRlc2NyaXB0aW9uQ29udGV4dCk6IFBhcnRpYWw8RGVzY3JpcHRpb25Ob2RlPiA9PiB7XG4gICAgcmV0dXJuIGNyZWF0ZURlc2NyaXB0aW9uTm9kZShcbiAgICAgIGNvbnRleHQudGV4dCxcbiAgICAgIHRoaXMudmlzaXREZXNjcmlwdGlvbkxpbmUoY29udGV4dC5kZXNjcmlwdGlvbkxpbmUoKSlcbiAgICApXG4gIH1cblxuICB2aXNpdERlc2NyaXB0aW9uTGluZSA9IChjb250ZXh0OiBQYXJzZXIuRGVzY3JpcHRpb25MaW5lQ29udGV4dCk6IFBhcnRpYWw8SW5saW5lVGFnTm9kZT5bXSA9PiB7XG4gICAgcmV0dXJuIHRoaXMudmlzaXREZXNjcmlwdGlvbkxpbmVFbGVtZW50KGNvbnRleHQuZGVzY3JpcHRpb25MaW5lRWxlbWVudCgpKTtcbiAgfVxuXG4gIHZpc2l0RGVzY3JpcHRpb25MaW5lRWxlbWVudCA9IChjb250ZXh0OiBQYXJzZXIuRGVzY3JpcHRpb25MaW5lRWxlbWVudENvbnRleHRbXSk6IFBhcnRpYWw8SW5saW5lVGFnTm9kZT5bXSA9PiB7XG4gICAgcmV0dXJuIChjb250ZXh0IHx8IFtdKS5tYXAoZWxlbWVudCA9PiB7XG4gICAgICByZXR1cm4gZWxlbWVudC5pbmxpbmVUYWcoKSA/IHRoaXMudmlzaXRJbmxpbmVUYWcoZWxlbWVudC5pbmxpbmVUYWcoKSkgOiB1bmRlZmluZWRcbiAgICB9KS5maWx0ZXIoZWxlbWVudCA9PiBlbGVtZW50ICE9PSB1bmRlZmluZWQpO1xuICB9XG5cbiAgdmlzaXRJbmxpbmVUYWcgPSAoY29udGV4dDogUGFyc2VyLklubGluZVRhZ0NvbnRleHQpOiBQYXJ0aWFsPElubGluZVRhZ05vZGU+ID0+IHtcbiAgICByZXR1cm4gY3JlYXRlSW5saW5lVGFnTm9kZShcbiAgICAgIHRoaXMudmlzaXRJZGVudGlmaWVyKGNvbnRleHQuaW5saW5lVGFnTmFtZSgpLmlkZW50aWZpZXIoKSksXG4gICAgICB0aGlzLnZpc2l0SW5saW5lVGFnQm9keShjb250ZXh0LmlubGluZVRhZ0JvZHkoKSksXG4gICAgICB0aGlzLm9wdGlvbnMuc2hvd05vZGVUZXh0ID8gY29udGV4dC50ZXh0IDogdW5kZWZpbmVkXG4gICAgKTtcbiAgfVxuXG4gIHZpc2l0SW5saW5lVGFnQm9keSA9IChjb250ZXh0OiBQYXJzZXIuSW5saW5lVGFnQm9keUNvbnRleHQpOiBzdHJpbmcgPT4ge1xuICAgIHJldHVybiBjb250ZXh0LmJyYWNlQm9keSgpLm1hcChib2R5ID0+IGJvZHkudGV4dCkuam9pbignJyk7XG4gIH1cbn0iXX0=