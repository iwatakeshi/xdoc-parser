"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const _ = require("lodash");
/* Documentation */
/**
 * Removes undefined, null, and false properties from an object.
 *
 * # API
 *
 * ```
 * @param object
 * ```
 */
function sanitize(object) {
    // Object.keys(object).forEach((key) => (object[key] == null) && delete object[key]);
    return _.pickBy(object);
}
/**
 *
 * Merges multiple objects into a single object
 *
 * # API
 *
 * ```
 * @function join
 * @param to: object - The target object.
 * @param from: object[] - The objects to merge.
 * ```
 */
function join(to, ...from) {
    return from.reduce(function (b, a) {
        for (var key in a)
            b[key] = a[key];
        return b;
    }, to);
}
/**
 * Creates a Documentation node.
 *
 * # API
 *
 * ```
 * @param body: BodyNode - The body node. See. {@link XDocASTNode.ts::BodyNode}
 * @param text?: string - The string representation of the body node.
 * @return DocumentationNode - See {@link XDocASTNode.ts::DocumentationNode}.
 * ```
 */
function createDocumentationNode(body, text) {
    return { documentation: join(sanitize({ body }), body.text ? { text: body.text } : {}) };
}
exports.createDocumentationNode = createDocumentationNode;
/**
 * Creates a Body node.
 */
function createBodyNode(annotations, text) {
    return join(sanitize({ annotations }), text ? { text } : {});
}
exports.createBodyNode = createBodyNode;
/* Tag */
function createTagNode(name, identifier, type, expression, description, text) {
    const object = Object.assign({}, name, identifier, type, expression, description);
    return join(sanitize(object), text ? { text } : {});
}
exports.createTagNode = createTagNode;
function createTagNameNode(name, text) {
    return join(sanitize({ name }), text ? { text } : {});
}
exports.createTagNameNode = createTagNameNode;
function createTagIdentifierNode(identifier, property, text) {
    let node = {};
    if (identifier)
        Object.assign(node, { identifier });
    else if (property)
        Object.assign(node, { property });
    return join(sanitize(node), text ? { text } : {});
}
exports.createTagIdentifierNode = createTagIdentifierNode;
function createOptionalTagIdentifierNode(identifier) {
    return identifier;
}
exports.createOptionalTagIdentifierNode = createOptionalTagIdentifierNode;
function createPropertyTagIdentifierNode(property, text) {
    return join(sanitize({ property }), text ? { text } : {});
}
exports.createPropertyTagIdentifierNode = createPropertyTagIdentifierNode;
function createIdentifierNode(text, optional = false, property) {
    if (!optional)
        optional = false;
    if (!property)
        property = [];
    return { identifier: join(sanitize({ optional, property }), text ? { text } : {}) };
}
exports.createIdentifierNode = createIdentifierNode;
function createOptionalIdentifierNode(optional = true, property, text) {
    return createIdentifierNode(text, optional, property);
}
exports.createOptionalIdentifierNode = createOptionalIdentifierNode;
/* Type */
/**
 *
 * Creates a Type node.
 *
 * # API
 *
 * ```
 * @export
 * @function createTypeNode
 * @param type: UnionTypeNode
 * | LambdaTypeNode
 * | TupleTypeNode
 * | PrimaryTypeNode
 * | ParenthesizedTypeNode
 * | UnaryTypeNode
 * | ObjectTypeNode
 * | ArrayTypeNode
 * | PropertyTypeNode
 * - The type of node to create.
 * @param optional = false
 * - Determines whether the type of node is optional.
 * ```
 */
function createTypeNode(type, optional = false, text) {
    return join({ type }, sanitize({ optional }), text ? { text } : {});
}
exports.createTypeNode = createTypeNode;
/**
 * Creates an IntersectionType node.
 *
 * # API
 *
 * ```
 * @public left: TypeNode - The type of node that appears on the left-hand side.
 * @public right: TypeNode - The type of node that appears on the right-hand side.
 * ```
 */
function createIntersectTypeNode(left, right, text) {
    return { intersect: join(sanitize({ left, right }), text ? { text } : {}) };
}
exports.createIntersectTypeNode = createIntersectTypeNode;
/**
 * Creates an UnionType node.
 *
 * # API
 *
 * ```
 * @export
 * @public left: TypeNode - The type of node that appears on the left-hand side.
 * @public right: TypeNode - The type of node that appears on the right-hand side.
 * ```
 */
function createUnionTypeNode(left, right, text) {
    return { union: join(sanitize({ left, right }), text ? { text } : {}) };
}
exports.createUnionTypeNode = createUnionTypeNode;
/**
 * Creates a LambdaType node.
 *
 * # API
 *
 * ```
 * - The single parameter in a lambda type.
 * @param parameters: FormalParameterSequencce | undefined[] | null
 * - The sequence of parameters in a lambda type.
 * @param type: TypeNode
 * - The return type in a lambda type.
 * ```
 */
function createLambdaTypeNode(parameters, type, text) {
    if (!parameters)
        parameters = [];
    return { lambda: join(sanitize({ parameters, type }), text ? { text } : {}) };
}
exports.createLambdaTypeNode = createLambdaTypeNode;
function createFormalParemeterSequenceNode(parameters, text) {
    return { parameters, text };
}
exports.createFormalParemeterSequenceNode = createFormalParemeterSequenceNode;
function createParameterNode(identifier, type, text) {
    return join(sanitize({ identifier, type }), text ? { text } : {});
}
exports.createParameterNode = createParameterNode;
function createTupleTypeNode(identifier, types, text) {
    return { tuple: join(sanitize({ identifier, types }), text ? { text } : {}) };
}
exports.createTupleTypeNode = createTupleTypeNode;
function createTupleExtendedTypeNode(type, heritage, text) {
    return join(sanitize({ type, heritage }), text ? { text } : {});
}
exports.createTupleExtendedTypeNode = createTupleExtendedTypeNode;
function createPrimaryTypeNode(primary, text) {
    return join(sanitize({ primary }), text ? { text } : {});
}
exports.createPrimaryTypeNode = createPrimaryTypeNode;
function createKeywordNode(text) {
    return { keyword: text ? { text } : {} };
}
exports.createKeywordNode = createKeywordNode;
function createParenthesizedTypeNode(type, optional = false, text) {
    return { parenthesized: join(sanitize({ type, optional }), text ? { text } : {}) };
}
exports.createParenthesizedTypeNode = createParenthesizedTypeNode;
function createUnaryTypeNode(operator, right, text) {
    return { unary: join(sanitize({ operator, right }), text ? { text } : {}) };
}
exports.createUnaryTypeNode = createUnaryTypeNode;
function createObjectTypeNode(object, text) {
    if (!object)
        object = [];
    return join(sanitize({ object }), text ? { text } : {});
}
exports.createObjectTypeNode = createObjectTypeNode;
function createObjectPairTypeNode(key, value, text) {
    return join(sanitize({ key, value }), text ? { text } : {});
}
exports.createObjectPairTypeNode = createObjectPairTypeNode;
function createArrayTypeNode(type, types, text) {
    if (!types)
        types = [];
    return { array: join(sanitize({ type, types }), text ? { text } : {}) };
}
exports.createArrayTypeNode = createArrayTypeNode;
function createPropertyIdentifierNode(property, text) {
    return createIdentifierNode(text, false, property);
}
exports.createPropertyIdentifierNode = createPropertyIdentifierNode;
;
/* Expression */
function createExpressionNode(expression, text) {
    return join(sanitize({ expression }), text ? { text } : {});
}
exports.createExpressionNode = createExpressionNode;
function createUnaryExpressionNode(operator, right, text) {
    return { unary: join(sanitize({ operator, right }), text ? { text } : {}) };
}
exports.createUnaryExpressionNode = createUnaryExpressionNode;
function createBinaryExpressionNode(operator, left, right, text) {
    return { binary: join(sanitize({ left, right, operator }), text ? { text } : {}) };
}
exports.createBinaryExpressionNode = createBinaryExpressionNode;
function createArrayExpressionNode(array, text) {
    if (!array)
        array = [];
    return join(sanitize({ array }), text ? { text } : {});
}
exports.createArrayExpressionNode = createArrayExpressionNode;
function createObjectExpressionNode(object, text) {
    if (!object)
        object = [];
    return join(sanitize({ object }), text ? { text } : {});
}
exports.createObjectExpressionNode = createObjectExpressionNode;
function createObjectPairExpressionNode(key, value, text) {
    return join(sanitize({ key, value }), text ? { text } : {});
}
exports.createObjectPairExpressionNode = createObjectPairExpressionNode;
function createLambdaExpressionNode(parameters, type, text) {
    if (!parameters)
        parameters = [];
    return createLambdaTypeNode(parameters, type, text);
}
exports.createLambdaExpressionNode = createLambdaExpressionNode;
function createParenthesizedExpressioneNode(expression, optional = false, text) {
    return { parenthesized: join(sanitize({ expression, optional }), text ? { text } : {}) };
}
exports.createParenthesizedExpressioneNode = createParenthesizedExpressioneNode;
;
function createLiteralExpressionNode(type, text) {
    return { literal: join(sanitize({ type }), text ? { text } : {}) };
}
exports.createLiteralExpressionNode = createLiteralExpressionNode;
function createDescriptionNode(text, inlines) {
    if (!inlines)
        inlines = [];
    return { description: join(sanitize({ inlines }), text ? { text } : {}) };
}
exports.createDescriptionNode = createDescriptionNode;
function createInlineTagNode(identifier, body, text) {
    return join(sanitize({ identifier, body }), text ? { text } : {});
}
exports.createInlineTagNode = createInlineTagNode;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiWERvY0FTVE5vZGUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvWERvY0FTVE5vZGUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSw0QkFBNEI7QUFDNUIsbUJBQW1CO0FBRW5COzs7Ozs7OztHQVFHO0FBQ0gsa0JBQXFCLE1BQWM7SUFDakMscUZBQXFGO0lBQ3JGLE9BQU8sQ0FBQyxDQUFDLE1BQU0sQ0FBQyxNQUFNLENBQWUsQ0FBQTtBQUN2QyxDQUFDO0FBRUQ7Ozs7Ozs7Ozs7O0dBV0c7QUFDSCxjQUFpQixFQUFVLEVBQUUsR0FBRyxJQUFjO0lBQzVDLE9BQU8sSUFBSSxDQUFDLE1BQU0sQ0FBQyxVQUFVLENBQUMsRUFBRSxDQUFDO1FBQy9CLEtBQUssSUFBSSxHQUFHLElBQUksQ0FBQztZQUFFLENBQUMsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDbkMsT0FBTyxDQUFDLENBQUM7SUFDWCxDQUFDLEVBQUUsRUFBRSxDQUFlLENBQUM7QUFDdkIsQ0FBQztBQUVEOzs7Ozs7Ozs7O0dBVUc7QUFDSCxpQ0FDRSxJQUF1QixFQUN2QixJQUFhO0lBRWIsT0FBTyxFQUFFLGFBQWEsRUFBRSxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUE7QUFDMUYsQ0FBQztBQUxELDBEQUtDO0FBU0Q7O0dBRUc7QUFDSCx3QkFDRSxXQUFxQyxFQUNyQyxJQUFhO0lBRWIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsV0FBVyxFQUFFLENBQUMsRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFDLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDO0FBQy9E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QyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQztBQUMzRixDQUFDO0FBTkQsZ0ZBTUM7QUFPQSxDQUFDO0FBR0YscUNBQ0UsSUFBWSxFQUNaLElBQVk7SUFFWixPQUFPLEVBQUUsT0FBTyxFQUFFLElBQUksQ0FBQyxRQUFRLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksQ0FBQyxDQUFDLENBQUMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsQ0FBQTtBQUNwRSxDQUFDO0FBTEQsa0VBS0M7QUFTRCwrQkFDRSxJQUFZLEVBQ1osT0FBa0M7SUFFbEMsSUFBSSxDQUFDLE9BQU87UUFBRSxPQUFPLEdBQUcsRUFBRSxDQUFBO0lBQzFCLE9BQU8sRUFBRSxXQUFXLEVBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBQyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFBO0FBQzNFLENBQUM7QUFORCxzREFNQztBQVNELDZCQUNFLFVBQW1DLEVBQ25DLElBQVksRUFDWixJQUFhO0lBRWIsT0FBTyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsVUFBVSxFQUFFLElBQUksRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLElBQUksRUFBRSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQTtBQUNuRSxDQUFDO0FBTkQsa0RBTUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgKiBhcyBfIGZyb20gXCJsb2Rhc2hcIjtcbi8qIERvY3VtZW50YXRpb24gKi9cblxuLyoqXG4gKiBSZW1vdmVzIHVuZGVmaW5lZCwgbnVsbCwgYW5kIGZhbHNlIHByb3BlcnRpZXMgZnJvbSBhbiBvYmplY3QuXG4gKiBcbiAqICMgQVBJXG4gKiBcbiAqIGBgYFxuICogQHBhcmFtIG9iamVjdFxuICogYGBgXG4gKi9cbmZ1bmN0aW9uIHNhbml0aXplPFQ+KG9iamVjdDogb2JqZWN0KSB7XG4gIC8vIE9iamVjdC5rZXlzKG9iamVjdCkuZm9yRWFjaCgoa2V5KSA9PiAob2JqZWN0W2tleV0gPT0gbnVsbCkgJiYgZGVsZXRlIG9iamVjdFtrZXldKTtcbiAgcmV0dXJuIF8ucGlja0J5KG9iamVjdCkgYXMgUGFydGlhbDxUPlxufVxuXG4vKipcbiAqIFxuICogTWVyZ2VzIG11bHRpcGxlIG9iamVjdHMgaW50byBhIHNpbmdsZSBvYmplY3RcbiAqIFxuICogIyBBUElcbiAqIFxuICogYGBgXG4gKiBAZnVuY3Rpb24gam9pblxuICogQHBhcmFtIHRvOiBvYmplY3QgLSBUaGUgdGFyZ2V0IG9iamVjdC5cbiAqIEBwYXJhbSBmcm9tOiBvYmplY3RbXSAtIFRoZSBvYmplY3RzIHRvIG1lcmdlLlxuICogYGBgXG4gKi9cbmZ1bmN0aW9uIGpvaW48VD4odG86IG9iamVjdCwgLi4uZnJvbTogb2JqZWN0W10pIHtcbiAgcmV0dXJuIGZyb20ucmVkdWNlKGZ1bmN0aW9uIChiLCBhKSB7XG4gICAgZm9yICh2YXIga2V5IGluIGEpIGJba2V5XSA9IGFba2V5XTtcbiAgICByZXR1cm4gYjtcbiAgfSwgdG8pIGFzIFBhcnRpYWw8VD47XG59XG5cbi8qKlxuICogQ3JlYXRlcyBhIERvY3VtZW50YXRpb24gbm9kZS5cbiAqIFxuICogIyBBUElcbiAqIFxuICogYGBgXG4gKiBAcGFyYW0gYm9keTogQm9keU5vZGUgLSBUaGUgYm9keSBub2RlLiBTZWUuIHtAbGluayBYRG9jQVNUTm9kZS50czo6Qm9keU5vZGV9XG4gKiBAcGFyYW0gdGV4dD86IHN0cmluZyAtIFRoZSBzdHJpbmcgcmVwcmVzZW50YXRpb24gb2YgdGhlIGJvZHkgbm9kZS5cbiAqIEByZXR1cm4gRG9jdW1lbnRhdGlvbk5vZGUgLSBTZWUge0BsaW5rIFhEb2NBU1ROb2RlLnRzOjpEb2N1bWVudGF0aW9uTm9kZX0uXG4gKiBgYGBcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZURvY3VtZW50YXRpb25Ob2RlKFxuICBib2R5OiBQYXJ0aWFsPEJvZHlOb2RlPixcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxEb2N1bWVudGF0aW9uTm9kZT4ge1xuICByZXR1cm4geyBkb2N1bWVudGF0aW9uOiBqb2luKHNhbml0aXplKHsgYm9keSB9KSwgYm9keS50ZXh0ID8geyB0ZXh0OiBib2R5LnRleHQgfSA6IHt9KSB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRG9jdW1lbnRhdGlvbk5vZGUge1xuICBkb2N1bWVudGF0aW9uOiB7XG4gICAgYm9keT86IFBhcnRpYWw8Qm9keU5vZGU+LFxuICAgIHRleHQ/OiBzdHJpbmdcbiAgfVxufVxuXG4vKipcbiAqIENyZWF0ZXMgYSBCb2R5IG5vZGUuXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCb2R5Tm9kZShcbiAgYW5ub3RhdGlvbnM6IFBhcnRpYWw8QW5ub3RhdGlvbnNOb2RlPixcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxCb2R5Tm9kZT4ge1xuICByZXR1cm4gam9pbihzYW5pdGl6ZSh7IGFubm90YXRpb25zIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSk7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQm9keU5vZGUge1xuICBhbm5vdGF0aW9uczogUGFydGlhbDxBbm5vdGF0aW9uc05vZGU+LFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCB0eXBlIEFubm90YXRpb25zTm9kZSA9IFBhcnRpYWw8VGFnTm9kZT5bXSB8IHVuZGVmaW5lZFtdO1xuXG4vKiBUYWcgKi9cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVRhZ05vZGUoXG4gIG5hbWU6IFBhcnRpYWw8VGFnTmFtZU5vZGU+LFxuICBpZGVudGlmaWVyOiBQYXJ0aWFsPFRhZ0lkZW50aWZpZXJOb2RlPiB8IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+LFxuICB0eXBlOiBQYXJ0aWFsPFR5cGVOb2RlPixcbiAgZXhwcmVzc2lvbjogUGFydGlhbDxFeHByZXNzaW9uTm9kZT4sXG4gIGRlc2NyaXB0aW9uOiBQYXJ0aWFsPERlc2NyaXB0aW9uTm9kZT4sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFRhZ05vZGUge1xuICBjb25zdCBvYmplY3QgPSBPYmplY3QuYXNzaWduKHt9LCBuYW1lLCBpZGVudGlmaWVyLCB0eXBlLCBleHByZXNzaW9uLCBkZXNjcmlwdGlvbik7XG4gIHJldHVybiBqb2luKHNhbml0aXplKG9iamVjdCksIHRleHQgPyB7IHRleHQgfSA6IHt9KTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUYWdOb2RlIHtcbiAgbmFtZT86IFBhcnRpYWw8VGFnTmFtZU5vZGU+LFxuICBpZGVudGlmaWVyPzogUGFydGlhbDxUYWdJZGVudGlmaWVyTm9kZT4sXG4gIHR5cGU/OiBQYXJ0aWFsPFR5cGVOb2RlPixcbiAgZXhwcmVzc2lvbj86IFBhcnRpYWw8RXhwcmVzc2lvbk5vZGU+LFxuICBkZXNjcmlwdGlvbj86IFBhcnRpYWw8RGVzY3JpcHRpb25Ob2RlPixcbiAgdGV4dD86IHN0cmluZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVGFnTmFtZU5vZGUoXG4gIG5hbWU6IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+LFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFRhZ05hbWVOb2RlPiB7XG4gIHJldHVybiBqb2luKHNhbml0aXplKHsgbmFtZSB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgVGFnTmFtZU5vZGUge1xuICBuYW1lOiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPixcbiAgdGV4dD86IHN0cmluZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVGFnSWRlbnRpZmllck5vZGUoXG4gIGlkZW50aWZpZXI6IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+IHwgUGFydGlhbDxPcHRpb25hbElkZW50aWZpZXJOb2RlPiB8IHVuZGVmaW5lZCxcbiAgcHJvcGVydHk/OiBQYXJ0aWFsPFByb3BlcnR5VGFnSWRlbnRpZmllck5vZGU+IHwgdW5kZWZpbmVkLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFRhZ0lkZW50aWZpZXJOb2RlPiB7XG4gIGxldCBub2RlID0ge31cbiAgaWYgKGlkZW50aWZpZXIpIE9iamVjdC5hc3NpZ24obm9kZSwgeyBpZGVudGlmaWVyIH0pXG4gIGVsc2UgaWYgKHByb3BlcnR5KSBPYmplY3QuYXNzaWduKG5vZGUsIHsgcHJvcGVydHkgfSlcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUobm9kZSksIHRleHQgPyB7IHRleHQgfSA6IHt9KTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUYWdJZGVudGlmaWVyTm9kZSB7XG4gIGlkZW50aWZpZXI/OiBJZGVudGlmaWVyTm9kZSB8IE9wdGlvbmFsVGFnSWRlbnRpZmllck5vZGVcbiAgcHJvcGVydHk/OiBQcm9wZXJ0eVRhZ0lkZW50aWZpZXJOb2RlLFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPcHRpb25hbFRhZ0lkZW50aWZpZXJOb2RlKFxuICBpZGVudGlmaWVyOiBQYXJ0aWFsPE9wdGlvbmFsVGFnSWRlbnRpZmllck5vZGU+XG4pOiBQYXJ0aWFsPE9wdGlvbmFsSWRlbnRpZmllck5vZGU+IHtcbiAgcmV0dXJuIGlkZW50aWZpZXI7XG59XG5cbmV4cG9ydCB0eXBlIE9wdGlvbmFsVGFnSWRlbnRpZmllck5vZGUgPSBPcHRpb25hbElkZW50aWZpZXJOb2RlO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQcm9wZXJ0eVRhZ0lkZW50aWZpZXJOb2RlKFxuICBwcm9wZXJ0eTogUGFydGlhbDwoSWRlbnRpZmllck5vZGUgfCBPcHRpb25hbFRhZ0lkZW50aWZpZXJOb2RlKT5bXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFByb3BlcnR5VGFnSWRlbnRpZmllck5vZGU+IHtcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUoeyBwcm9wZXJ0eSB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pXG59XG5leHBvcnQgaW50ZXJmYWNlIFByb3BlcnR5VGFnSWRlbnRpZmllck5vZGUge1xuICAvLyBTaG9ydGN1dCBvZiBPcHRpb25hbFRhZ09ySWRlbnRpZmllclxuICBwcm9wZXJ0eTogKElkZW50aWZpZXJOb2RlIHwgT3B0aW9uYWxUYWdJZGVudGlmaWVyTm9kZSlbXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJZGVudGlmaWVyTm9kZShcbiAgdGV4dDogc3RyaW5nLFxuICBvcHRpb25hbCA9IGZhbHNlLFxuICBwcm9wZXJ0eT86IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+W10gfCB1bmRlZmluZWRbXSxcbik6IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+IHtcbiAgaWYgKCFvcHRpb25hbCkgb3B0aW9uYWwgPSBmYWxzZTtcbiAgaWYgKCFwcm9wZXJ0eSkgcHJvcGVydHkgPSBbXVxuXG4gIHJldHVybiB7IGlkZW50aWZpZXI6IGpvaW4oc2FuaXRpemUoeyBvcHRpb25hbCwgcHJvcGVydHkgfSksIHRleHQgPyB7IHRleHQgfSA6IHt9KSB9XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSWRlbnRpZmllck5vZGUge1xuICBpZGVudGlmaWVyOiB7XG4gICAgb3B0aW9uYWw/OiBib29sZWFuLFxuICAgIHByb3BlcnR5PzogSWRlbnRpZmllck5vZGVbXSB8IHVuZGVmaW5lZFtdXG4gICAgdGV4dD86IHN0cmluZ1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPcHRpb25hbElkZW50aWZpZXJOb2RlKFxuICBvcHRpb25hbCA9IHRydWUsXG4gIHByb3BlcnR5OiBJZGVudGlmaWVyTm9kZVtdIHwgdW5kZWZpbmVkW10sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8T3B0aW9uYWxJZGVudGlmaWVyTm9kZT4ge1xuICByZXR1cm4gY3JlYXRlSWRlbnRpZmllck5vZGUodGV4dCwgb3B0aW9uYWwsIHByb3BlcnR5KTtcbn1cblxuZXhwb3J0IHR5cGUgT3B0aW9uYWxJZGVudGlmaWVyTm9kZSA9IElkZW50aWZpZXJOb2RlXG5cblxuLyogVHlwZSAqL1xuXG4vKipcbiAqIFxuICogQ3JlYXRlcyBhIFR5cGUgbm9kZS5cbiAqIFxuICogIyBBUElcbiAqIFxuICogYGBgXG4gKiBAZXhwb3J0XG4gKiBAZnVuY3Rpb24gY3JlYXRlVHlwZU5vZGVcbiAqIEBwYXJhbSB0eXBlOiBVbmlvblR5cGVOb2RlXG4gKiB8IExhbWJkYVR5cGVOb2RlXG4gKiB8IFR1cGxlVHlwZU5vZGVcbiAqIHwgUHJpbWFyeVR5cGVOb2RlXG4gKiB8IFBhcmVudGhlc2l6ZWRUeXBlTm9kZVxuICogfCBVbmFyeVR5cGVOb2RlXG4gKiB8IE9iamVjdFR5cGVOb2RlXG4gKiB8IEFycmF5VHlwZU5vZGVcbiAqIHwgUHJvcGVydHlUeXBlTm9kZVxuICogLSBUaGUgdHlwZSBvZiBub2RlIHRvIGNyZWF0ZS5cbiAqIEBwYXJhbSBvcHRpb25hbCA9IGZhbHNlIFxuICogLSBEZXRlcm1pbmVzIHdoZXRoZXIgdGhlIHR5cGUgb2Ygbm9kZSBpcyBvcHRpb25hbC5cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHlwZU5vZGUoXG4gIHR5cGU6IFBhcnRpYWw8SW50ZXJzZWN0VHlwZU5vZGU+XG4gICAgfCBQYXJ0aWFsPFVuaW9uVHlwZU5vZGU+XG4gICAgfCBQYXJ0aWFsPExhbWJkYVR5cGVOb2RlPlxuICAgIHwgUGFydGlhbDxUdXBsZVR5cGVOb2RlPlxuICAgIHwgUGFydGlhbDxQcmltYXJ5VHlwZU5vZGU+XG4gICAgfCBQYXJ0aWFsPFBhcmVudGhlc2l6ZWRUeXBlTm9kZT5cbiAgICB8IFBhcnRpYWw8VW5hcnlUeXBlTm9kZT5cbiAgICB8IFBhcnRpYWw8T2JqZWN0VHlwZU5vZGU+XG4gICAgfCBQYXJ0aWFsPEFycmF5VHlwZU5vZGU+XG4gICAgfCBQYXJ0aWFsPFByb3BlcnR5SWRlbnRpZmllck5vZGU+LFxuICBvcHRpb25hbCA9IGZhbHNlLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFR5cGVOb2RlPiB7XG4gIHJldHVybiBqb2luKHsgdHlwZSB9LCBzYW5pdGl6ZSh7IG9wdGlvbmFsIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUeXBlTm9kZSB7XG4gIGludGVyc2VjdD86IEludGVyc2VjdFR5cGVOb2RlLFxuICB1bmlvbj86IFVuaW9uVHlwZU5vZGUsXG4gIGxhbWJkYT86IExhbWJkYVR5cGVOb2RlLFxuICB0dXBsZT86IFR1cGxlVHlwZU5vZGUsXG4gIHByaW1hcnk/OiBQcmltYXJ5VHlwZU5vZGUsXG4gIHBhcmVudGhlc2l6ZWQ/OiBQYXJlbnRoZXNpemVkVHlwZU5vZGUsXG4gIHVuYXJ5PzogVW5hcnlUeXBlTm9kZSxcbiAgb2JqZWN0PzogT2JqZWN0VHlwZU5vZGUsXG4gIGFycmF5PzogQXJyYXlUeXBlTm9kZSxcbiAgcHJvcGVydHk/OiBQcm9wZXJ0eUlkZW50aWZpZXJOb2RlLFxuICBvcHRpb25hbD86IGJvb2xlYW4sXG4gIHRleHQ/OiBzdHJpbmdcbn1cblxuLyoqXG4gKiBDcmVhdGVzIGFuIEludGVyc2VjdGlvblR5cGUgbm9kZS5cbiAqIFxuICogIyBBUElcbiAqIFxuICogYGBgXG4gKiBAcHVibGljIGxlZnQ6IFR5cGVOb2RlIC0gVGhlIHR5cGUgb2Ygbm9kZSB0aGF0IGFwcGVhcnMgb24gdGhlIGxlZnQtaGFuZCBzaWRlLlxuICogQHB1YmxpYyByaWdodDogVHlwZU5vZGUgLSBUaGUgdHlwZSBvZiBub2RlIHRoYXQgYXBwZWFycyBvbiB0aGUgcmlnaHQtaGFuZCBzaWRlLlxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVJbnRlcnNlY3RUeXBlTm9kZShcbiAgbGVmdDogVHlwZU5vZGUsXG4gIHJpZ2h0OiBUeXBlTm9kZSxcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxJbnRlcnNlY3RUeXBlTm9kZT4ge1xuICByZXR1cm4geyBpbnRlcnNlY3Q6IGpvaW4oc2FuaXRpemUoeyBsZWZ0LCByaWdodCB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBJbnRlcnNlY3RUeXBlTm9kZSB7XG4gIGludGVyc2VjdDoge1xuICAgIGxlZnQ/OiBUeXBlTm9kZSxcbiAgICByaWdodD86IFR5cGVOb2RlLFxuICAgIHRleHQ/OiBzdHJpbmdcbiAgfVxufVxuXG5cbi8qKlxuICogQ3JlYXRlcyBhbiBVbmlvblR5cGUgbm9kZS5cbiAqIFxuICogIyBBUElcbiAqIFxuICogYGBgXG4gKiBAZXhwb3J0XG4gKiBAcHVibGljIGxlZnQ6IFR5cGVOb2RlIC0gVGhlIHR5cGUgb2Ygbm9kZSB0aGF0IGFwcGVhcnMgb24gdGhlIGxlZnQtaGFuZCBzaWRlLlxuICogQHB1YmxpYyByaWdodDogVHlwZU5vZGUgLSBUaGUgdHlwZSBvZiBub2RlIHRoYXQgYXBwZWFycyBvbiB0aGUgcmlnaHQtaGFuZCBzaWRlLlxuICogYGBgXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVVbmlvblR5cGVOb2RlKFxuICBsZWZ0OiBUeXBlTm9kZSxcbiAgcmlnaHQ6IFR5cGVOb2RlLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFVuaW9uVHlwZU5vZGU+IHtcbiAgcmV0dXJuIHsgdW5pb246IGpvaW4oc2FuaXRpemUoeyBsZWZ0LCByaWdodCB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBVbmlvblR5cGVOb2RlIHtcbiAgdW5pb246IHtcbiAgICBsZWZ0PzogVHlwZU5vZGUsXG4gICAgcmlnaHQ/OiBUeXBlTm9kZSxcbiAgICB0ZXh0Pzogc3RyaW5nXG4gIH1cbn1cblxuLyoqXG4gKiBDcmVhdGVzIGEgTGFtYmRhVHlwZSBub2RlLlxuICogXG4gKiAjIEFQSVxuICogXG4gKiBgYGBcbiAqIC0gVGhlIHNpbmdsZSBwYXJhbWV0ZXIgaW4gYSBsYW1iZGEgdHlwZS5cbiAqIEBwYXJhbSBwYXJhbWV0ZXJzOiBGb3JtYWxQYXJhbWV0ZXJTZXF1ZW5jY2UgfCB1bmRlZmluZWRbXSB8IG51bGxcbiAqIC0gVGhlIHNlcXVlbmNlIG9mIHBhcmFtZXRlcnMgaW4gYSBsYW1iZGEgdHlwZS5cbiAqIEBwYXJhbSB0eXBlOiBUeXBlTm9kZVxuICogLSBUaGUgcmV0dXJuIHR5cGUgaW4gYSBsYW1iZGEgdHlwZS5cbiAqIGBgYFxuICovXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlTGFtYmRhVHlwZU5vZGUoXG4gIHBhcmFtZXRlcnM6IFBhcnRpYWw8Rm9ybWFsUGFyYW1ldGVyU2VxdWVuY2VOb2RlPiB8IHVuZGVmaW5lZFtdLFxuICB0eXBlOiBUeXBlTm9kZSxcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxMYW1iZGFUeXBlTm9kZT4ge1xuICBpZiAoIXBhcmFtZXRlcnMpIHBhcmFtZXRlcnMgPSBbXVxuICByZXR1cm4geyBsYW1iZGE6IGpvaW4oc2FuaXRpemUoeyBwYXJhbWV0ZXJzLCB0eXBlIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIExhbWJkYVR5cGVOb2RlIHtcbiAgbGFtYmRhOiB7XG4gICAgcGFyYW1ldGVycz86IEZvcm1hbFBhcmFtZXRlclNlcXVlbmNlTm9kZSB8IHVuZGVmaW5lZFtdLFxuICAgIHR5cGU/OiBUeXBlTm9kZSxcbiAgICB0ZXh0Pzogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZvcm1hbFBhcmVtZXRlclNlcXVlbmNlTm9kZShcbiAgcGFyYW1ldGVyczogUGFydGlhbDxQYXJhbWV0ZXJOb2RlPltdIHwgdW5kZWZpbmVkW10sXG4gIHRleHQ/OiBzdHJpbmdcbik6IEZvcm1hbFBhcmFtZXRlclNlcXVlbmNlTm9kZSB7XG4gIHJldHVybiB7IHBhcmFtZXRlcnMsIHRleHQgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEZvcm1hbFBhcmFtZXRlclNlcXVlbmNlTm9kZSB7XG4gIHBhcmFtZXRlcnM6IFBhcnRpYWw8UGFyYW1ldGVyTm9kZT5bXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQYXJhbWV0ZXJOb2RlKFxuICBpZGVudGlmaWVyOiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPixcbiAgdHlwZT86IFBhcnRpYWw8VHlwZU5vZGU+LFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPFBhcmFtZXRlck5vZGU+IHtcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUoeyBpZGVudGlmaWVyLCB0eXBlIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQYXJhbWV0ZXJOb2RlIHtcbiAgaWRlbnRpZmllcjogUGFydGlhbDxJZGVudGlmaWVyTm9kZT4sXG4gIHR5cGU/OiBQYXJ0aWFsPFR5cGVOb2RlPixcbiAgdGV4dD86IHN0cmluZ1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlVHVwbGVUeXBlTm9kZShcbiAgaWRlbnRpZmllcjogUGFydGlhbDxJZGVudGlmaWVyTm9kZT4sXG4gIHR5cGVzOiBQYXJ0aWFsPFR5cGVOb2RlIHwgVHVwbGVFeHRlbmRlZFR5cGVOb2RlPltdIHwgdW5kZWZpbmVkW10sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8VHVwbGVUeXBlTm9kZT4ge1xuICByZXR1cm4geyB0dXBsZTogam9pbihzYW5pdGl6ZSh7IGlkZW50aWZpZXIsIHR5cGVzIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFR1cGxlVHlwZU5vZGUge1xuICB0dXBsZToge1xuICAgIGlkZW50aWZpZXI/OiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPixcbiAgICB0eXBlcz86IFBhcnRpYWw8VHlwZU5vZGUgfCBUdXBsZUV4dGVuZGVkVHlwZU5vZGU+W10gfCB1bmRlZmluZWRbXSxcbiAgICB0ZXh0Pzogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVR1cGxlRXh0ZW5kZWRUeXBlTm9kZShcbiAgdHlwZTogUGFydGlhbDxQcmltYXJ5VHlwZU5vZGU+LFxuICBoZXJpdGFnZTogUGFydGlhbDxQcmltYXJ5VHlwZU5vZGU+LCB0ZXh0Pzogc3RyaW5nXG4pOiBUdXBsZUV4dGVuZGVkVHlwZU5vZGUge1xuICByZXR1cm4gam9pbihzYW5pdGl6ZSh7IHR5cGUsIGhlcml0YWdlIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBUdXBsZUV4dGVuZGVkVHlwZU5vZGUge1xuICB0eXBlPzogUGFydGlhbDxQcmltYXJ5VHlwZU5vZGU+XG4gIGhlcml0YWdlPzogUGFydGlhbDxQcmltYXJ5VHlwZU5vZGU+XG4gIHRleHQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVByaW1hcnlUeXBlTm9kZShcbiAgcHJpbWFyeTogUGFydGlhbDxPcHRpb25hbElkZW50aWZpZXJOb2RlPiB8IFBhcnRpYWw8KElkZW50aWZpZXJOb2RlIHwgS2V5d29yZE5vZGUpPiB8IFBhcnRpYWw8UHJvcGVydHlJZGVudGlmaWVyTm9kZT4sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8UHJpbWFyeVR5cGVOb2RlPiB7XG4gIHJldHVybiBqb2luKHNhbml0aXplKHsgcHJpbWFyeSB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUHJpbWFyeVR5cGVOb2RlIHtcbiAgcHJpbWFyeTogUGFydGlhbDxPcHRpb25hbElkZW50aWZpZXJOb2RlPiB8IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+IHwgS2V5d29yZE5vZGUsXG4gIHRleHQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUtleXdvcmROb2RlKFxuICB0ZXh0OiBzdHJpbmcgfCBcIm51bGxcIiB8IFwidW5kZWZpbmVkXCJcbik6IEtleXdvcmROb2RlIHtcbiAgcmV0dXJuIHsga2V5d29yZDogdGV4dCA/IHsgdGV4dCB9IDoge30gfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEtleXdvcmROb2RlIHtcbiAga2V5d29yZDoge1xuICAgIHRleHQ/OiBzdHJpbmdcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlUGFyZW50aGVzaXplZFR5cGVOb2RlKFxuICB0eXBlOiBQYXJ0aWFsPFR5cGVOb2RlPixcbiAgb3B0aW9uYWwgPSBmYWxzZSxcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxQYXJlbnRoZXNpemVkVHlwZU5vZGU+IHtcbiAgcmV0dXJuIHsgcGFyZW50aGVzaXplZDogam9pbihzYW5pdGl6ZSh7IHR5cGUsIG9wdGlvbmFsIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfTtcbn1cblxuZXhwb3J0IGludGVyZmFjZSBQYXJlbnRoZXNpemVkVHlwZU5vZGUge1xuICBwYXJlbnRoZXNpemVkOiB7XG4gICAgdHlwZT86IFBhcnRpYWw8VHlwZU5vZGU+LFxuICAgIHRleHQ/OiBzdHJpbmdcbiAgfVxufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVVbmFyeVR5cGVOb2RlKFxuICBvcGVyYXRvcjogc3RyaW5nIHwgXCImXCIgfCBcIipcIixcbiAgcmlnaHQ6IFBhcnRpYWw8UHJpbWFyeVR5cGVOb2RlPixcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxVbmFyeVR5cGVOb2RlPiB7XG4gIHJldHVybiB7IHVuYXJ5OiBqb2luKHNhbml0aXplKHsgb3BlcmF0b3IsIHJpZ2h0IH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIFVuYXJ5VHlwZU5vZGUge1xuICB1bmFyeToge1xuICAgIG9wZXJhdG9yPzogc3RyaW5nIHwgXCImXCIgfCBcIipcIixcbiAgICByaWdodD86IFBhcnRpYWw8UHJpbWFyeVR5cGVOb2RlPixcbiAgICB0ZXh0Pzogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU9iamVjdFR5cGVOb2RlKFxuICBvYmplY3Q/OiBQYXJ0aWFsPE9iamVjdFBhaXJUeXBlTm9kZT5bXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPE9iamVjdFR5cGVOb2RlPiB7XG4gIGlmICghb2JqZWN0KSBvYmplY3QgPSBbXTtcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUoeyBvYmplY3QgfSksIHRleHQgPyB7IHRleHQgfSA6IHt9KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIE9iamVjdFR5cGVOb2RlIHtcbiAgb2JqZWN0OiBQYXJ0aWFsPE9iamVjdFBhaXJUeXBlTm9kZT5bXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPYmplY3RQYWlyVHlwZU5vZGUoXG4gIGtleTogVHlwZU5vZGUsXG4gIHZhbHVlOiBUeXBlTm9kZSxcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxPYmplY3RQYWlyVHlwZU5vZGU+IHtcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUoeyBrZXksIHZhbHVlIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPYmplY3RQYWlyVHlwZU5vZGUge1xuICBrZXk6IFBhcnRpYWw8VHlwZU5vZGU+LFxuICB2YWx1ZTogUGFydGlhbDxUeXBlTm9kZT4sXG4gIHRleHQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUFycmF5VHlwZU5vZGUoXG4gIHR5cGU6IFBhcnRpYWw8VHlwZU5vZGU+LFxuICB0eXBlczogUGFydGlhbDxUeXBlTm9kZT5bXSB8IHVuZGVmaW5lZFtdLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBBcnJheVR5cGVOb2RlIHtcbiAgaWYgKCF0eXBlcykgdHlwZXMgPSBbXTtcblxuICByZXR1cm4geyBhcnJheTogam9pbihzYW5pdGl6ZSh7IHR5cGUsIHR5cGVzIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEFycmF5VHlwZU5vZGUge1xuICBhcnJheToge1xuICAgIHR5cGU/OiBQYXJ0aWFsPFR5cGVOb2RlPixcbiAgICB0eXBlcz86IFBhcnRpYWw8VHlwZU5vZGU+W10gfCB1bmRlZmluZWRbXSxcbiAgICB0ZXh0Pzogc3RyaW5nXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVByb3BlcnR5SWRlbnRpZmllck5vZGUoXG4gIHByb3BlcnR5OiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPltdIHwgdW5kZWZpbmVkW10sXG4gIHRleHQ6IHN0cmluZ1xuKTogUGFydGlhbDxQcm9wZXJ0eUlkZW50aWZpZXJOb2RlPiB7XG4gIHJldHVybiBjcmVhdGVJZGVudGlmaWVyTm9kZSh0ZXh0LCBmYWxzZSwgcHJvcGVydHkpXG59O1xuXG5leHBvcnQgaW50ZXJmYWNlIFByb3BlcnR5SWRlbnRpZmllck5vZGUgZXh0ZW5kcyBJZGVudGlmaWVyTm9kZSB7IH1cblxuXG4vKiBFeHByZXNzaW9uICovXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUV4cHJlc3Npb25Ob2RlKFxuICBleHByZXNzaW9uOlxuICAgIFBhcnRpYWw8VW5hcnlFeHByZXNzaW9uTm9kZT5cbiAgICB8IFBhcnRpYWw8QmluYXJ5RXhwcmVzc2lvbk5vZGU+XG4gICAgfCBQYXJ0aWFsPEFycmF5RXhwcmVzc2lvbk5vZGU+XG4gICAgfCBQYXJ0aWFsPE9iamVjdEV4cHJlc3Npb25Ob2RlPlxuICAgIHwgUGFydGlhbDxMYW1iZGFFeHByZXNzaW9uTm9kZT5cbiAgICB8IFBhcnRpYWw8TGl0ZXJhbEV4cHJlc3Npb25Ob2RlPlxuICAgIHwgUGFydGlhbDxQYXJlbnRoZXNpemVkRXhwcmVzc2lvbk5vZGU+LFxuICB0ZXh0Pzogc3RyaW5nLFxuKTogUGFydGlhbDxFeHByZXNzaW9uTm9kZT4ge1xuICByZXR1cm4gam9pbihzYW5pdGl6ZSh7IGV4cHJlc3Npb24gfSksIHRleHQgPyB7IHRleHQgfSA6IHt9KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEV4cHJlc3Npb25Ob2RlIHtcbiAgZXhwcmVzc2lvbjpcbiAgVW5hcnlFeHByZXNzaW9uTm9kZVxuICB8IEJpbmFyeUV4cHJlc3Npb25Ob2RlXG4gIHwgQXJyYXlFeHByZXNzaW9uTm9kZVxuICB8IE9iamVjdEV4cHJlc3Npb25Ob2RlXG4gIHwgTGFtYmRhRXhwcmVzc2lvbk5vZGVcbiAgfCBMaXRlcmFsRXhwcmVzc2lvbk5vZGVcbiAgfCBQYXJlbnRoZXNpemVkRXhwcmVzc2lvbk5vZGVcbiAgdGV4dD86IHN0cmluZ1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVVbmFyeUV4cHJlc3Npb25Ob2RlKFxuICBvcGVyYXRvcjogc3RyaW5nIHwgJysnIHwgJy0nLFxuICByaWdodDogUGFydGlhbDxFeHByZXNzaW9uTm9kZT4sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8VW5hcnlFeHByZXNzaW9uTm9kZT4ge1xuICByZXR1cm4geyB1bmFyeTogam9pbihzYW5pdGl6ZSh7IG9wZXJhdG9yLCByaWdodCB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBVbmFyeUV4cHJlc3Npb25Ob2RlIHtcbiAgdW5hcnk6IHtcbiAgICBvcGVyYXRvcj86IHN0cmluZyB8ICcrJyB8ICctJyxcbiAgICByaWdodD86IFBhcnRpYWw8RXhwcmVzc2lvbk5vZGU+LFxuICAgIHRleHQ/OiBzdHJpbmdcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQmluYXJ5RXhwcmVzc2lvbk5vZGUoXG4gIG9wZXJhdG9yOiBzdHJpbmcgfCAnKycgfCAnLScsXG4gIGxlZnQ6IFBhcnRpYWw8RXhwcmVzc2lvbk5vZGU+LFxuICByaWdodDogUGFydGlhbDxFeHByZXNzaW9uTm9kZT4sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8QmluYXJ5RXhwcmVzc2lvbk5vZGU+IHtcbiAgcmV0dXJuIHsgYmluYXJ5OiBqb2luKHNhbml0aXplKHsgbGVmdCwgcmlnaHQsIG9wZXJhdG9yIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIEJpbmFyeUV4cHJlc3Npb25Ob2RlIHtcbiAgYmluYXJ5OiB7XG4gICAgb3BlcmF0b3I/OiBzdHJpbmcgfCAnKycgfCAnLScgfCAnKicgfCAnLycsXG4gICAgbGVmdD86IEV4cHJlc3Npb25Ob2RlLFxuICAgIHJpZ2h0PzogRXhwcmVzc2lvbk5vZGUsXG4gICAgdGV4dD86IHN0cmluZ1xuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBcnJheUV4cHJlc3Npb25Ob2RlKFxuICBhcnJheT86IFBhcnRpYWw8RXhwcmVzc2lvbk5vZGU+W10sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8QXJyYXlFeHByZXNzaW9uTm9kZT4ge1xuICBpZiAoIWFycmF5KSBhcnJheSA9IFtdO1xuICByZXR1cm4gam9pbihzYW5pdGl6ZSh7IGFycmF5IH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBBcnJheUV4cHJlc3Npb25Ob2RlIHtcbiAgYXJyYXk/OiBQYXJ0aWFsPEV4cHJlc3Npb25Ob2RlPltdLFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVPYmplY3RFeHByZXNzaW9uTm9kZShcbiAgb2JqZWN0PzogUGFydGlhbDxPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGU+W10sXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8T2JqZWN0RXhwcmVzc2lvbk5vZGU+IHtcbiAgaWYgKCFvYmplY3QpIG9iamVjdCA9IFtdXG4gIHJldHVybiBqb2luKHNhbml0aXplKHsgb2JqZWN0IH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPYmplY3RFeHByZXNzaW9uTm9kZSB7XG4gIG9iamVjdDogUGFydGlhbDxPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGU+W10sXG4gIHRleHQ/OiBzdHJpbmdcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU9iamVjdFBhaXJFeHByZXNzaW9uTm9kZShcbiAga2V5OiBQYXJ0aWFsPExpdGVyYWxFeHByZXNzaW9uTm9kZT4sXG4gIHZhbHVlOiBQYXJ0aWFsPE9iamVjdEV4cHJlc3Npb25Ob2RlPiB8IFBhcnRpYWw8TGl0ZXJhbEV4cHJlc3Npb25Ob2RlPixcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGU+IHtcbiAgcmV0dXJuIGpvaW4oc2FuaXRpemUoeyBrZXksIHZhbHVlIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSlcbn1cblxuZXhwb3J0IGludGVyZmFjZSBPYmplY3RQYWlyRXhwcmVzc2lvbk5vZGUge1xuICBrZXk6IFBhcnRpYWw8TGl0ZXJhbEV4cHJlc3Npb25Ob2RlPixcbiAgdmFsdWU6IFBhcnRpYWw8T2JqZWN0RXhwcmVzc2lvbk5vZGU+IHwgUGFydGlhbDxMaXRlcmFsRXhwcmVzc2lvbk5vZGU+LFxuICB0ZXh0Pzogc3RyaW5nXG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVMYW1iZGFFeHByZXNzaW9uTm9kZShcbiAgcGFyYW1ldGVyczogRm9ybWFsUGFyYW1ldGVyU2VxdWVuY2VOb2RlIHwgdW5kZWZpbmVkW10sXG4gIHR5cGU6IFR5cGVOb2RlLFxuICB0ZXh0Pzogc3RyaW5nXG4pOiBQYXJ0aWFsPExhbWJkYUV4cHJlc3Npb25Ob2RlPiB7XG4gIGlmICghcGFyYW1ldGVycykgcGFyYW1ldGVycyA9IFtdXG4gIHJldHVybiBjcmVhdGVMYW1iZGFUeXBlTm9kZShwYXJhbWV0ZXJzLCB0eXBlLCB0ZXh0KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIExhbWJkYUV4cHJlc3Npb25Ob2RlIGV4dGVuZHMgTGFtYmRhVHlwZU5vZGUgeyB9XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVQYXJlbnRoZXNpemVkRXhwcmVzc2lvbmVOb2RlKFxuICBleHByZXNzaW9uOiBQYXJ0aWFsPEV4cHJlc3Npb25Ob2RlPixcbiAgb3B0aW9uYWwgPSBmYWxzZSxcbiAgdGV4dD86IHN0cmluZ1xuKTogUGFydGlhbDxQYXJlbnRoZXNpemVkRXhwcmVzc2lvbk5vZGU+IHtcbiAgcmV0dXJuIHsgcGFyZW50aGVzaXplZDogam9pbihzYW5pdGl6ZSh7IGV4cHJlc3Npb24sIG9wdGlvbmFsIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfTtcbn1cbmV4cG9ydCBpbnRlcmZhY2UgUGFyZW50aGVzaXplZEV4cHJlc3Npb25Ob2RlIHtcbiAgcGFyZW50aGVzaXplZDoge1xuICAgIGV4cHJlc3Npb24/OiBFeHByZXNzaW9uTm9kZSxcbiAgICBvcHRpb25hbD86IGJvb2xlYW4sXG4gICAgdGV4dD86IHN0cmluZ1xuICB9XG59O1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVMaXRlcmFsRXhwcmVzc2lvbk5vZGUoXG4gIHR5cGU6IHN0cmluZyxcbiAgdGV4dDogc3RyaW5nXG4pOiBQYXJ0aWFsPExpdGVyYWxFeHByZXNzaW9uTm9kZT4ge1xuICByZXR1cm4geyBsaXRlcmFsOiBqb2luKHNhbml0aXplKHsgdHlwZSB9KSwgdGV4dCA/IHsgdGV4dCB9IDoge30pIH1cbn1cblxuZXhwb3J0IGludGVyZmFjZSBMaXRlcmFsRXhwcmVzc2lvbk5vZGUge1xuICBsaXRlcmFsOiB7XG4gICAgdHlwZT86IHN0cmluZyxcbiAgICB0ZXh0Pzogc3RyaW5nLFxuICB9XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVEZXNjcmlwdGlvbk5vZGUoXG4gIHRleHQ6IHN0cmluZyxcbiAgaW5saW5lcz86IFBhcnRpYWw8SW5saW5lVGFnTm9kZT5bXVxuKTogUGFydGlhbDxEZXNjcmlwdGlvbk5vZGU+IHtcbiAgaWYgKCFpbmxpbmVzKSBpbmxpbmVzID0gW11cbiAgcmV0dXJuIHsgZGVzY3JpcHRpb246IGpvaW4oc2FuaXRpemUoeyBpbmxpbmVzIH0pLCB0ZXh0ID8geyB0ZXh0IH0gOiB7fSkgfVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIERlc2NyaXB0aW9uTm9kZSB7XG4gIGRlc2NyaXB0aW9uOiB7XG4gICAgdGV4dD86IHN0cmluZyxcbiAgICBpbmxpbmVzPzogUGFydGlhbDxJbmxpbmVUYWdOb2RlPltdXG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUlubGluZVRhZ05vZGUoXG4gIGlkZW50aWZpZXI6IFBhcnRpYWw8SWRlbnRpZmllck5vZGU+LFxuICBib2R5OiBzdHJpbmcsXG4gIHRleHQ/OiBzdHJpbmdcbik6IFBhcnRpYWw8SW5saW5lVGFnTm9kZT4ge1xuICByZXR1cm4gam9pbihzYW5pdGl6ZSh7IGlkZW50aWZpZXIsIGJvZHkgfSksIHRleHQgPyB7IHRleHQgfSA6IHt9KVxufVxuXG5leHBvcnQgaW50ZXJmYWNlIElubGluZVRhZ05vZGUge1xuICBpZGVudGlmaWVyOiBQYXJ0aWFsPElkZW50aWZpZXJOb2RlPixcbiAgYm9keT86IHN0cmluZyxcbiAgdGV4dD86IHN0cmluZ1xufSJdfQ==